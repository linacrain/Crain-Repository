"0","cny_business_percent<-pelcro_table%>%"
"0","  filter(businessunitcode==""CNY"")%>%"
"0","  filter(productname=='Health Pulse')%>%"
"0","  select(customeraccountid)%>%"
"0","  distinct()%>%"
"0","  left_join(pelcro_customer_data_b,by=c(""customeraccountid""=""customeraccountid""))%>%"
"0","  mutate(metadatacrainbusinessindustry=as.numeric(metadatacrainbusinessindustry))%>%"
"0","  left_join(cny_b,by=c(""metadatacrainbusinessindustry""=""Code""))%>%"
"0","  mutate(Value=ifelse(is.na(Value)|str_detect(Value,""Others Allied""),""Other"",Value))%>%"
"0","  group_by(Value)%>%"
"0","  summarise(n=n_distinct(customeraccountid))%>%"
"0","  arrange(desc(n))%>%"
"0","  filter(Value!=""Other"")%>%"
"0","  top_n(5,n)%>%"
"0","  mutate(Brand=""CNY Health Pulse"")%>%"
"0","  mutate(`Business Industry`=Value)%>%"
"0","  mutate(`Active Customers`=n)%>%"
"0","  mutate(`Total Customers`=cny_totals-cny_b_other)%>%"
"0","  select(-c(Value,n))%>%"
"0","  mutate(`Share of Customers`=round(`Active Customers`/`Total Customers`,3)*100)"
"0",""
"0","ccb_business_percent<-pelcro_table%>%"
"0","  select(customeraccountid,businessunitcode,productname)%>%"
"0","  filter(businessunitcode==""CCB"")%>%"
"0","  filter(str_detect(productname,""Health""))%>%"
"0","  distinct()%>%"
"0","  left_join(pelcro_customer_data,by=c(""customeraccountid""=""customeraccountid""))%>%"
"0","  mutate(metadatacrainbusinessindustry=as.numeric(metadatacrainbusinessindustry))%>%"
"0","  left_join(ccb_b,by=c(""metadatacrainbusinessindustry""=""ID""))%>%"
"0","  mutate(Value=ifelse(is.na(Value),""Others Allied to the Field"",Value))%>%"
"0","  group_by(Value)%>%"
"0","  summarise(n=n_distinct(customeraccountid))%>%"
"0","  arrange(desc(n))%>%"
"0","  mutate(`Business Industry`= Value,"
"0","         `Active Customers`=n)%>%"
"0","  mutate(`Total Customers`=ccb_totals-ccb_b_other_counts)%>%"
"0","  filter(`Business Industry`!=""Others Allied to the Field"")%>%"
"0","  top_n(10,`Active Customers`)%>%"
"0","  mutate(Brand=""CCB"")%>%"
"0","  select(Brand,`Business Industry`,`Active Customers`,`Total Customers`)%>%"
"0","  top_n(5,`Active Customers`)%>%"
"0","  mutate(`Share of Customers`=round(`Active Customers`/`Total Customers`,3)*100)"
"0","  "
"0","MH_business_percent<-adv_data%>%"
"0","  select(shiptocustomernumber)%>%"
"0","  distinct()%>%"
"0","  left_join(index,by=c(""shiptocustomernumber""=""advantagecustomerid""))%>%"
"0","  mutate(clickshareuserid=as.numeric(clickshareuserid))%>%"
"0","  left_join(business_job_adv,by=c(""clickshareuserid""=""clickshareuserid""))%>%"
"0","  left_join(mh_b,by=c(""busind""=""ID""))%>%"
"0","  group_by(shiptocustomernumber)%>%"
"0","  mutate(v_check=ifelse(Value==""unknown""|is.na(Value),0,1))%>%"
"0","  mutate(max_v=max(v_check,na.rm=TRUE))%>%"
"0","  filter(v_check==max_v)%>%"
"0","  mutate(Value=ifelse(is.na(Value),""unknown"",Value))%>%"
"0","  group_by(Value)%>%"
"0","  summarise(`Active Customers`=n_distinct(shiptocustomernumber,na.rm=TRUE))%>%"
"0","  arrange(desc(`Active Customers`))%>%"
"0","  ungroup()%>%"
"0","  mutate(`Business Industry`=Value)%>%"
"0","  select(-Value)%>%"
"0","  mutate(`Total Subscribers`=sum(`Active Customers`))%>%"
"0","  top_n(10,`Active Customers`)%>%"
"0","  select(`Business Industry`,`Active Customers`,`Total Subscribers`)%>%"
"0","  filter(`Business Industry`!='unknown'&!str_detect(`Business Industry`,""Other Health""))%>%"
"0","    top_n(10,`Active Customers`)%>%"
"0","  mutate(Brand=""MH"")%>%"
"0","  select(Brand,`Business Industry`,`Active Customers`)%>%"
"0","  top_n(5,`Active Customers`)%>%"
"0","  mutate(`Total Customers`=mh_totals-mh_b_other)%>%"
"0","  mutate(`Share of Customers`=round(`Active Customers`/`Total Customers`,3)*100)"
"0",""
"0","j_p_bind<-rbind(cny_business_percent,ccb_business_percent,MH_business_percent)"
"0",""
"0","j_p_bind%>%"
"0","  ggplot(aes(reorder(`Business Industry`,`Share of Customers`),`Share of Customers`,label=`Share of Customers`,fill=Brand))+geom_bar(position=""dodge"",stat=""identity"")+geom_text(position=""dodge"",hjust=-0.1,size=2.5)+theme_minimal()+xlab(""Business Industry"")+ylab(""Share of Active Non-Other Customers"")+labs(title=""Share of Business Industries Across Brands"")+facet_grid(~Brand,space=""free_x"")+coord_flip()"
