"0","AN_cleaned_ADV_rows<-AN_aggregated%>%"
"0","  mutate(Date=as.Date(Date,format=""%Y-%m-%d""))%>%"
"0","  group_by(uid_max)%>%"
"0","  arrange(Date,Visit.Number,Clicks.to.Page,.by_group=TRUE)%>%"
"0","  group_by(Date,uid_max,Mobile.Device.Type,Referrer.Type)%>%"
"0","  mutate(Visitor.Access..v61...evar61.=ifelse(Visitor.Access..v61...evar61.=="""",""anonymous"",Visitor.Access..v61...evar61.))%>%"
"0","  mutate(visitor_access_level=ifelse(Visitor.Access..v61...evar61.==""reg""|Visitor.Access..v61...evar61.==""reg_mexico""|Visitor.Access..v61...evar61.==""registered"",1,"
"0","                                     ifelse(Visitor.Access..v61...evar61.==""anonymous"",0,2)))%>%"
"0","  group_by(uid_max,Date,Referrer.Type)%>%"
"0","  summarise(visitor_access_level=max(visitor_access_level,na.rm=TRUE),"
"0","            n_visits=n_distinct(paste(Visitor_ID,Visit.Number)),"
"0","            did_order=max(Orders),"
"0","            )%>%"
"0","  group_by(uid_max)%>%"
"0","  arrange(Date,.by_group=TRUE)%>%"
"0","  group_by(uid_max,Date)%>%"
"0","  spread(Referrer.Type,n_visits)%>%"
"0","  group_by(uid_max,Date)%>%"
"0","  summarise(visitor_access_level=max(visitor_access_level),"
"0","            did_order=max(did_order),"
"0","            `other.web.sites`=sum(`other web sites`,na.rm=TRUE),"
"0","            `search.engines`=sum(`search engines`,na.rm=TRUE),"
"0","            `social.networks`=sum(`social networks`,na.rm=TRUE),"
"0","            `typed_bookmarked`=sum(`typed/bookmarked`,na.rm=TRUE))%>%"
"0","  ungroup()%>%"
"0","  group_by(uid_max)%>%"
"0","  summarise(visitor_access_level=max(visitor_access_level),"
"0","            total_days=n_distinct(Date),"
"0","            `other.web.sites`=sum(`other.web.sites`,na.rm=TRUE),"
"0","            `search.engines`=sum(`search.engines`,na.rm=TRUE),"
"0","            `social.networks`=sum(`social.networks`,na.rm=TRUE),"
"0","            `typed_bookmarked`=sum(`typed_bookmarked`,na.rm=TRUE))%>%"
"0","  left_join(last_touch_info,by=c(""uid_max""=""uid_max""))%>%"
"0","  left_join(order_info_an,by=c(""Purchase.IDs""=""ordernumber""))%>%"
"0","  filter(!is.na(publicationcode))%>%"
"0","  mutate(product=ifelse((publicationcode==""AN4""&n==2)|(publicationcode==""AN3""&n==2),""All Access"","
"0","                        ifelse(publicationcode==""AN2""&n==1,""Digital Only"","
"0","                               ifelse(publicationcode==""AN1"",""Premium (Digital + Print)"",""Other""))))%>%"
"0","  mutate(product_level=ifelse(product==""All Access"",4,"
"0","                              ifelse(product==""Premium (Digital + Print)"",3,"
"0","                                     ifelse(product==""Digital Only"",2,1))))%>%"
"0","  group_by(uid_max,visitor_access_level,total_days,other.web.sites,search.engines,social.networks,typed_bookmarked,Purchase.IDs,Referrer.Type,termlength)%>%"
"0","  summarise(p=max(product_level))%>%"
"0","  mutate(product=ifelse(p==2,""Digital Only"","
"0","                        ifelse(p==3,""Premium (Digital + Print)"",""All Access"")))%>%"
"0","  mutate(product=ifelse(product==""Digital Only""&termlength<=4,""Digital Only - Monthly"","
"0","                        ifelse(product==""Digital Only""&termlength>4,""Digital Only - Annual"",product)))%>%"
"0","  mutate(last_touch_referrer=Referrer.Type)%>%"
"0","  ungroup()%>%"
"0","  select(-c(p,termlength,Referrer.Type))%>%"
"0","  distinct()"
"1","[38;5;232m`summarise()` has grouped output by 'uid_max', 'Date'. You can override using the `.groups` argument.[39m
"
"1","[38;5;232m`summarise()` has grouped output by 'uid_max'. You can override using the `.groups` argument.[39m
"
"1","[38;5;232m`summarise()` has grouped output by 'uid_max', 'visitor_access_level', 'total_days', 'other.web.sites',
'search.engines', 'social.networks', 'typed_bookmarked', 'Purchase.IDs', 'Referrer.Type'. You can override using the
`.groups` argument.[39m
"
"0","AN_cleaned_pelcro_rows<-AN_aggregated%>%"
"0","  mutate(Date=as.Date(Date,format=""%Y-%m-%d""))%>%"
"0","  group_by(uid_max)%>%"
"0","  arrange(Date,Visit.Number,Clicks.to.Page,.by_group=TRUE)%>%"
"0","  group_by(Date,uid_max,Mobile.Device.Type,Referrer.Type)%>%"
"0","  mutate(Visitor.Access..v61...evar61.=ifelse(Visitor.Access..v61...evar61.=="""",""anonymous"",Visitor.Access..v61...evar61.))%>%"
"0","  mutate(visitor_access_level=ifelse(Visitor.Access..v61...evar61.==""reg""|Visitor.Access..v61...evar61.==""reg_mexico""|Visitor.Access..v61...evar61.==""registered"",1,"
"0","                                     ifelse(Visitor.Access..v61...evar61.==""anonymous"",0,2)))%>%"
"0","  group_by(uid_max,Date,Referrer.Type)%>%"
"0","  summarise(visitor_access_level=max(visitor_access_level,na.rm=TRUE),"
"0","            n_visits=n_distinct(paste(Visitor_ID,Visit.Number)),"
"0","            did_order=max(Orders),"
"0","            )%>%"
"0","  group_by(uid_max)%>%"
"0","  arrange(Date,.by_group=TRUE)%>%"
"0","  group_by(uid_max,Date)%>%"
"0","  spread(Referrer.Type,n_visits)%>%"
"0","  group_by(uid_max,Date)%>%"
"0","  summarise(visitor_access_level=max(visitor_access_level),"
"0","            did_order=max(did_order),"
"0","            `other.web.sites`=sum(`other web sites`,na.rm=TRUE),"
"0","            `search.engines`=sum(`search engines`,na.rm=TRUE),"
"0","            `social.networks`=sum(`social networks`,na.rm=TRUE),"
"0","            `typed_bookmarked`=sum(`typed/bookmarked`,na.rm=TRUE))%>%"
"0","  ungroup()%>%"
"0","  group_by(uid_max)%>%"
"0","  summarise(visitor_access_level=max(visitor_access_level),"
"0","            total_days=n_distinct(Date),"
"0","            `other.web.sites`=sum(`other.web.sites`,na.rm=TRUE),"
"0","            `search.engines`=sum(`search.engines`,na.rm=TRUE),"
"0","            `social.networks`=sum(`social.networks`,na.rm=TRUE),"
"0","            `typed_bookmarked`=sum(`typed_bookmarked`,na.rm=TRUE))%>%"
"0","  left_join(last_touch_info,by=c(""uid_max""=""uid_max""))%>%"
"0","  left_join(order_info_an,by=c(""Purchase.IDs""=""ordernumber""))%>%"
"0","  filter(is.na(publicationcode))%>%"
"0","  mutate(uid_max=as.double(uid_max))%>%"
"0","  left_join(pelcro_info_an,by=c(""uid_max""=""shiptocustomernumber""))%>%"
"0","    left_join(last_touch_info_2,by=c(""uid_max""=""uid_max""))%>%"
"0","  mutate(orderdate=as.Date(orderdate))%>%"
"0","  filter(orderdate==Date)%>%"
"0","  ungroup()%>%"
"0","  mutate(publevel=ifelse(pubcode==""Basic Digital"",1,"
"0","                         ifelse(pubcode==""Premium"",2,3)))%>%"
"0","  group_by(uid_max)%>%"
"0","  mutate(mpublevel=max(publevel))%>%"
"0","  filter(publevel==mpublevel)%>%"
"0","  mutate(product=ifelse(pubcode==""Premium"",""Premium (Digital + Print)"","
"0","                        ifelse(pubcode==""All Access"",""All Access"","
"0","                               ifelse(pubcode==""Basic Digital""&termlength.y==""Annual"",""Digital Only - Annual"",""Digital Only - Monthly""))))%>%"
"0","  mutate(last_touch_referrer=Referrer.Type)%>%"
"0","  select(-c(Referrer.Type,publicationcode,termlength.x,n,invoiceid,subscriptionid,termlength.y,pubcode,orderdate,Date,publevel,mpublevel))%>%"
"0","  distinct()"
"1","[38;5;232m`summarise()` has grouped output by 'uid_max', 'Date'. You can override using the `.groups` argument.[39m
"
"1","[38;5;232m`summarise()` has grouped output by 'uid_max'. You can override using the `.groups` argument.[39m
"
"2","Warning:"
"2"," [38;5;232mThere was 1 warning in `mutate()`.[39m
[38;5;232m[36mâ„¹[38;5;232m In argument: `uid_max = as.double(uid_max)`.[39m
Caused by warning:
[33m![39m NAs introduced by coercion
"
"0","full_an_set<-rbind(AN_cleaned_ADV_rows,AN_cleaned_pelcro_rows)"
"0","full_an_set<-full_an_set%>%"
"0","  mutate(product=as.factor(product),"
"0","         last_touch_referrer=as.factor(last_touch_referrer),"
"0","         visitor_access_level=as.factor(ifelse(visitor_access_level==2,""subscribed"","
"0","                                               ifelse(visitor_access_level==1,""reg"",""anonymous""))))"
"0",""
"0","full_an_set%>%"
"0","  group_by(product)%>%"
"0","  summarise(n=n_distinct(uid_max))"
