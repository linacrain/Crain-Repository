data = full_mh_set,
family = "categorical",
chains = CHAINS, warmup = WARMUP, iter = ITER, seed = BAYES_SEED,
refresh = 0
)
mh_model_1
conditional_effects(mh_model_1)
conditional_effects(mh_model_1,categorical=TRUE)
full_mh_set
full_mh_set%>%
mutate(missing=ifelse(Referrer.Type=="missing",missing+1,missing),
`other web sites`=ifelse(Referrer.Type=="other web sites",`other web sites`+1,`other web sites`),
`search engines`=ifelse(Referrer.Type=="search engines",`search engines`+1,`search engines`),
`social networks`=ifelse(Referrer.Type=="social networks",`social networks`+1,`social networks`),
`typed/bookmarked`=ifelse(Referrer.Type=="typed/bookmarked",`typed/bookmarked`+1,`typed/bookmarked`))%>%
mutate(channel_level=ifelse(`missing`>0&`other web sites`==0&`search engines`==0&`social networks`==0&`typed/bookmarked`==0,"missing",
ifelse(`missing`==0&`other web sites`>0&`search engines`==0&`social networks`==0&`typed/bookmarked`==0,'other web sites',
ifelse(`missing`==0&`other web sites`==0&`search engines`>0&`social networks`==0&`typed/bookmarked`==0,'search engines',
ifelse(`missing`==0&`other web sites`==0&`search engines`==0&`social networks`>0&`typed/bookmarked`==0,'social networks',
ifelse(`missing`==0&`other web sites`==0&`search engines`==0&`social networks`==0&`typed/bookmarked`>0,'typed/bookmarked','Multi-channel'))))))%>%
group_by(channel_level,product)%>%
summarise(x=mean(total_days))%>%
ggplot(aes(channel_level,x,fill=product))+geom_bar(stat="identity",position="dodge")+theme_minimal()+coord_flip()+labs("Avg. Days to Order")
MH_aggregated%>%
mutate(missing=ifelse(Referrer.Type=="missing",missing+1,missing),
`other web sites`=ifelse(Referrer.Type=="other web sites",`other web sites`+1,`other web sites`),
`search engines`=ifelse(Referrer.Type=="search engines",`search engines`+1,`search engines`),
`social networks`=ifelse(Referrer.Type=="social networks",`social networks`+1,`social networks`),
`typed/bookmarked`=ifelse(Referrer.Type=="typed/bookmarked",`typed/bookmarked`+1,`typed/bookmarked`))%>%
mutate(channel_level=ifelse(`missing`>0&`other web sites`==0&`search engines`==0&`social networks`==0&`typed/bookmarked`==0,"missing",
ifelse(`missing`==0&`other web sites`>0&`search engines`==0&`social networks`==0&`typed/bookmarked`==0,'other web sites',
ifelse(`missing`==0&`other web sites`==0&`search engines`>0&`social networks`==0&`typed/bookmarked`==0,'search engines',
ifelse(`missing`==0&`other web sites`==0&`search engines`==0&`social networks`>0&`typed/bookmarked`==0,'social networks',
ifelse(`missing`==0&`other web sites`==0&`search engines`==0&`social networks`==0&`typed/bookmarked`>0,'typed/bookmarked','Multi-channel'))))))%>%
mutate(visitor_access_level=ifelse(visitor_access_level==3,"subscribed",
ifelse(visitor_access_level==1,"Reg","anonymous")))%>%
mutate(visitor_access_level=as.factor(visitor_access_level),
product=as.factor(product),
last_touch_referrer=as.factor(Referrer.Type))%>%
select(visitor_access_level,total_days,channel_level,last_touch_referrer,product)
MH_aggregated%>%
mutate(missing=ifelse(Referrer.Type=="missing",missing+1,missing),
`other web sites`=ifelse(Referrer.Type=="other web sites",`other web sites`+1,`other web sites`),
`search engines`=ifelse(Referrer.Type=="search engines",`search engines`+1,`search engines`),
`social networks`=ifelse(Referrer.Type=="social networks",`social networks`+1,`social networks`),
`typed/bookmarked`=ifelse(Referrer.Type=="typed/bookmarked",`typed/bookmarked`+1,`typed/bookmarked`))%>%
mutate(channel_level=ifelse(`missing`>0&`other web sites`==0&`search engines`==0&`social networks`==0&`typed/bookmarked`==0,"missing",
ifelse(`missing`==0&`other web sites`>0&`search engines`==0&`social networks`==0&`typed/bookmarked`==0,'other web sites',
ifelse(`missing`==0&`other web sites`==0&`search engines`>0&`social networks`==0&`typed/bookmarked`==0,'search engines',
ifelse(`missing`==0&`other web sites`==0&`search engines`==0&`social networks`>0&`typed/bookmarked`==0,'social networks',
ifelse(`missing`==0&`other web sites`==0&`search engines`==0&`social networks`==0&`typed/bookmarked`>0,'typed/bookmarked','Multi-channel'))))))%>%
mutate(visitor_access_level=ifelse(visitor_access_level==3,"subscribed",
ifelse(visitor_access_level==1,"Reg","anonymous")))%>%
mutate(visitor_access_level=as.factor(visitor_access_level),
product=as.factor(product),
last_touch_referrer=as.factor(Referrer.Type))%>%
select(visitor_access_level,total_days,channel_level,last_touch_referrer,product)
mh_full_set_channel_aggregation<-MH_aggregated%>%
mutate(missing=ifelse(Referrer.Type=="missing",missing+1,missing),
`other web sites`=ifelse(Referrer.Type=="other web sites",`other web sites`+1,`other web sites`),
`search engines`=ifelse(Referrer.Type=="search engines",`search engines`+1,`search engines`),
`social networks`=ifelse(Referrer.Type=="social networks",`social networks`+1,`social networks`),
`typed/bookmarked`=ifelse(Referrer.Type=="typed/bookmarked",`typed/bookmarked`+1,`typed/bookmarked`))%>%
mutate(channel_level=ifelse(`missing`>0&`other web sites`==0&`search engines`==0&`social networks`==0&`typed/bookmarked`==0,"missing",
ifelse(`missing`==0&`other web sites`>0&`search engines`==0&`social networks`==0&`typed/bookmarked`==0,'other web sites',
ifelse(`missing`==0&`other web sites`==0&`search engines`>0&`social networks`==0&`typed/bookmarked`==0,'search engines',
ifelse(`missing`==0&`other web sites`==0&`search engines`==0&`social networks`>0&`typed/bookmarked`==0,'social networks',
ifelse(`missing`==0&`other web sites`==0&`search engines`==0&`social networks`==0&`typed/bookmarked`>0,'typed/bookmarked','Multi-channel'))))))%>%
mutate(visitor_access_level=ifelse(visitor_access_level==3,"subscribed",
ifelse(visitor_access_level==1,"Reg","anonymous")))%>%
mutate(visitor_access_level=as.factor(visitor_access_level),
product=as.factor(product),
last_touch_referrer=as.factor(Referrer.Type))%>%
select(visitor_access_level,total_days,channel_level,last_touch_referrer,product)
gc()
mh_full_set_channel_aggregation<-MH_aggregated%>%
mutate(missing=ifelse(Referrer.Type=="missing",missing+1,missing),
`other web sites`=ifelse(Referrer.Type=="other web sites",`other web sites`+1,`other web sites`),
`search engines`=ifelse(Referrer.Type=="search engines",`search engines`+1,`search engines`),
`social networks`=ifelse(Referrer.Type=="social networks",`social networks`+1,`social networks`),
`typed/bookmarked`=ifelse(Referrer.Type=="typed/bookmarked",`typed/bookmarked`+1,`typed/bookmarked`))%>%
mutate(channel_level=ifelse(`missing`>0&`other web sites`==0&`search engines`==0&`social networks`==0&`typed/bookmarked`==0,"missing",
ifelse(`missing`==0&`other web sites`>0&`search engines`==0&`social networks`==0&`typed/bookmarked`==0,'other web sites',
ifelse(`missing`==0&`other web sites`==0&`search engines`>0&`social networks`==0&`typed/bookmarked`==0,'search engines',
ifelse(`missing`==0&`other web sites`==0&`search engines`==0&`social networks`>0&`typed/bookmarked`==0,'social networks',
ifelse(`missing`==0&`other web sites`==0&`search engines`==0&`social networks`==0&`typed/bookmarked`>0,'typed/bookmarked','Multi-channel'))))))%>%
mutate(visitor_access_level=ifelse(visitor_access_level==3,"subscribed",
ifelse(visitor_access_level==1,"Reg","anonymous")))%>%
mutate(visitor_access_level=as.factor(visitor_access_level),
product=as.factor(product),
last_touch_referrer=as.factor(Referrer.Type),
channel_level=as.factor(channel_level))%>%
select(visitor_access_level,total_days,channel_level,last_touch_referrer,product)
gc()
mh_model_2 <- brm(
bf(product~visitor_access_level+total_days+channel_level+last_touch_referrer),
data = mh_full_set_channel_aggregation,
family = "categorical",
chains = CHAINS, warmup = WARMUP, iter = ITER, seed = BAYES_SEED,
refresh = 0
)
MH_aggregated%>%
group_by(visitor_access_level,Referrer.Type,product)%>%
summarise(n=n_distinct(uid_max))%>%
mutate(last_touch_referrer=Referrer.Type)%>%
group_by(last_touch_referrer,visitor_access_level)%>%
mutate(total=sum(n))%>%
mutate(prop=round(n/total*100,1))%>%
ggplot(aes(Referrer.Type,prop,fill=product))+geom_bar(stat="identity",position="dodge")+theme_minimal()+coord_flip()+labs(x="Last Touch Referrer")+facet_wrap(vars(visitor_access_level))
MH_aggregated%>%
group_by(visitor_access_level,Referrer.Type,product)%>%
summarise(n=n_distinct(uid_max))%>%
mutate(last_touch_referrer=Referrer.Type)%>%
ggplot(aes(product,n,fill=product))+geom_boxplot(outliers=FALSE)+theme_minimal()+coord_flip()
MH_aggregated%>%
mutate(missing=ifelse(Referrer.Type=="missing",missing+1,missing),
`other web sites`=ifelse(Referrer.Type=="other web sites",`other web sites`+1,`other web sites`),
`search engines`=ifelse(Referrer.Type=="search engines",`search engines`+1,`search engines`),
`social networks`=ifelse(Referrer.Type=="social networks",`social networks`+1,`social networks`),
`typed/bookmarked`=ifelse(Referrer.Type=="typed/bookmarked",`typed/bookmarked`+1,`typed/bookmarked`))%>%
mutate(channel_level=ifelse(`missing`>0&`other web sites`==0&`search engines`==0&`social networks`==0&`typed/bookmarked`==0,"missing",
ifelse(`missing`==0&`other web sites`>0&`search engines`==0&`social networks`==0&`typed/bookmarked`==0,'other web sites',
ifelse(`missing`==0&`other web sites`==0&`search engines`>0&`social networks`==0&`typed/bookmarked`==0,'search engines',
ifelse(`missing`==0&`other web sites`==0&`search engines`==0&`social networks`>0&`typed/bookmarked`==0,'social networks',
ifelse(`missing`==0&`other web sites`==0&`search engines`==0&`social networks`==0&`typed/bookmarked`>0,'typed/bookmarked','Multi-channel'))))))%>%
group_by(channel_level,product)%>%
summarise(n=n_distinct(uid_max))%>%
mutate(total=sum(n))%>%
mutate(prop=round(n/total*100,1))%>%
ggplot(aes(channel_level,prop,fill=product))+geom_bar(stat="identity",position="dodge")+theme_minimal()+coord_flip()+labs(x="Channel Segment")
MH_aggregated%>%
mutate(missing=ifelse(Referrer.Type=="missing",missing+1,missing),
`other web sites`=ifelse(Referrer.Type=="other web sites",`other web sites`+1,`other web sites`),
`search engines`=ifelse(Referrer.Type=="search engines",`search engines`+1,`search engines`),
`social networks`=ifelse(Referrer.Type=="social networks",`social networks`+1,`social networks`),
`typed/bookmarked`=ifelse(Referrer.Type=="typed/bookmarked",`typed/bookmarked`+1,`typed/bookmarked`))%>%
mutate(channel_level=ifelse(`missing`>0&`other web sites`==0&`search engines`==0&`social networks`==0&`typed/bookmarked`==0,"missing",
ifelse(`missing`==0&`other web sites`>0&`search engines`==0&`social networks`==0&`typed/bookmarked`==0,'other web sites',
ifelse(`missing`==0&`other web sites`==0&`search engines`>0&`social networks`==0&`typed/bookmarked`==0,'search engines',
ifelse(`missing`==0&`other web sites`==0&`search engines`==0&`social networks`>0&`typed/bookmarked`==0,'social networks',
ifelse(`missing`==0&`other web sites`==0&`search engines`==0&`social networks`==0&`typed/bookmarked`>0,'typed/bookmarked','Multi-channel'))))))%>%
group_by(channel_level)%>%
summarise(n=n_distinct(uid_max))
MH_aggregated%>%
mutate(missing=ifelse(Referrer.Type=="missing",missing+1,missing),
`other web sites`=ifelse(Referrer.Type=="other web sites",`other web sites`+1,`other web sites`),
`search engines`=ifelse(Referrer.Type=="search engines",`search engines`+1,`search engines`),
`social networks`=ifelse(Referrer.Type=="social networks",`social networks`+1,`social networks`),
`typed/bookmarked`=ifelse(Referrer.Type=="typed/bookmarked",`typed/bookmarked`+1,`typed/bookmarked`))%>%
mutate(channel_level=ifelse(`missing`>0&`other web sites`==0&`search engines`==0&`social networks`==0&`typed/bookmarked`==0,"missing",
ifelse(`missing`==0&`other web sites`>0&`search engines`==0&`social networks`==0&`typed/bookmarked`==0,'other web sites',
ifelse(`missing`==0&`other web sites`==0&`search engines`>0&`social networks`==0&`typed/bookmarked`==0,'search engines',
ifelse(`missing`==0&`other web sites`==0&`search engines`==0&`social networks`>0&`typed/bookmarked`==0,'social networks',
ifelse(`missing`==0&`other web sites`==0&`search engines`==0&`social networks`==0&`typed/bookmarked`>0,'typed/bookmarked','Multi-channel'))))))%>%
group_by(channel_level,product)%>%
ggplot(aes(channel_level,total_days,fill=product))+geom_boxplot(outliers=FALSE)+theme_minimal()+coord_flip()
MH_aggregated%>%
mutate(missing=ifelse(Referrer.Type=="missing",missing+1,missing),
`other web sites`=ifelse(Referrer.Type=="other web sites",`other web sites`+1,`other web sites`),
`search engines`=ifelse(Referrer.Type=="search engines",`search engines`+1,`search engines`),
`social networks`=ifelse(Referrer.Type=="social networks",`social networks`+1,`social networks`),
`typed/bookmarked`=ifelse(Referrer.Type=="typed/bookmarked",`typed/bookmarked`+1,`typed/bookmarked`))%>%
mutate(channel_level=ifelse(`missing`>0&`other web sites`==0&`search engines`==0&`social networks`==0&`typed/bookmarked`==0,"missing",
ifelse(`missing`==0&`other web sites`>0&`search engines`==0&`social networks`==0&`typed/bookmarked`==0,'other web sites',
ifelse(`missing`==0&`other web sites`==0&`search engines`>0&`social networks`==0&`typed/bookmarked`==0,'search engines',
ifelse(`missing`==0&`other web sites`==0&`search engines`==0&`social networks`>0&`typed/bookmarked`==0,'social networks',
ifelse(`missing`==0&`other web sites`==0&`search engines`==0&`social networks`==0&`typed/bookmarked`>0,'typed/bookmarked','Multi-channel'))))))%>%
group_by(channel_level,product)%>%
summarise(x=mean(total_days))%>%
ggplot(aes(channel_level,x,fill=product))+geom_bar(stat="identity",position="dodge")+theme_minimal()+coord_flip()+labs("Avg. Days to Order")
MH_aggregated%>%
group_by(product)%>%
summarise(n=n_distinct(uid_max))%>%
mutate(total=sum(n))%>%
mutate(prop=round(n/total*100,2))
mutate(total=sum(n))%>%
mutate(prop=round(n/total*100,1))%>%
mutate(visitor_access_level=ifelse(visitor_access_level==3,"subscribed",
ifelse(visitor_access_level==1,"Reg","anonymous")))%>%
ggplot(aes(Referrer.Type,prop,fill=product))+geom_bar(stat="identity",position="dodge")+theme_minimal()+coord_flip()+labs(x="Last Touch Referrer")+facet_wrap(vars(visitor_access_level))%
MH_aggregated%>%
group_by(visitor_access_level,Referrer.Type,product)%>%
summarise(n=n_distinct(uid_max))%>%
mutate(last_touch_referrer=Referrer.Type)%>%
group_by(last_touch_referrer,visitor_access_level)%>%
mutate(total=sum(n))%>%
mutate(prop=round(n/total*100,1))%>%
mutate(visitor_access_level=ifelse(visitor_access_level==3,"subscribed",
ifelse(visitor_access_level==1,"Reg","anonymous")))%>%
ggplot(aes(Referrer.Type,prop,fill=product))+geom_bar(stat="identity",position="dodge")+theme_minimal()+coord_flip()+labs(x="Last Touch Referrer")+facet_wrap(vars(visitor_access_level))%
MH_aggregated%>%
group_by(visitor_access_level,Referrer.Type,product)%>%
summarise(n=n_distinct(uid_max))%>%
mutate(last_touch_referrer=Referrer.Type)%>%
group_by(last_touch_referrer,visitor_access_level)%>%
mutate(total=sum(n))%>%
mutate(prop=round(n/total*100,1))%>%
mutate(visitor_access_level=ifelse(visitor_access_level==3,"subscribed",
ifelse(visitor_access_level==1,"Reg","anonymous")))%>%
ggplot(aes(Referrer.Type,prop,fill=product))+geom_bar(stat="identity",position="dodge")+theme_minimal()+coord_flip()+labs(x="Last Touch Referrer")+facet_wrap(vars(visitor_access_level))
MH_aggregated%>%
mutate(missing=ifelse(Referrer.Type=="missing",missing+1,missing),
`other web sites`=ifelse(Referrer.Type=="other web sites",`other web sites`+1,`other web sites`),
`search engines`=ifelse(Referrer.Type=="search engines",`search engines`+1,`search engines`),
`social networks`=ifelse(Referrer.Type=="social networks",`social networks`+1,`social networks`),
`typed/bookmarked`=ifelse(Referrer.Type=="typed/bookmarked",`typed/bookmarked`+1,`typed/bookmarked`))%>%
mutate(channel_level=ifelse(`missing`>0&`other web sites`==0&`search engines`==0&`social networks`==0&`typed/bookmarked`==0,"missing",
ifelse(`missing`==0&`other web sites`>0&`search engines`==0&`social networks`==0&`typed/bookmarked`==0,'other web sites',
ifelse(`missing`==0&`other web sites`==0&`search engines`>0&`social networks`==0&`typed/bookmarked`==0,'search engines',
ifelse(`missing`==0&`other web sites`==0&`search engines`==0&`social networks`>0&`typed/bookmarked`==0,'social networks',
ifelse(`missing`==0&`other web sites`==0&`search engines`==0&`social networks`==0&`typed/bookmarked`>0,'typed/bookmarked','Multi-channel'))))))%>%
group_by(channel_level,product)%>%
ggplot(aes(channel_level,total_days,fill=product))+geom_boxplot(outliers=FALSE)+theme_minimal()+coord_flip()
MH_aggregated%>%
mutate(missing=ifelse(Referrer.Type=="missing",missing+1,missing),
`other web sites`=ifelse(Referrer.Type=="other web sites",`other web sites`+1,`other web sites`),
`search engines`=ifelse(Referrer.Type=="search engines",`search engines`+1,`search engines`),
`social networks`=ifelse(Referrer.Type=="social networks",`social networks`+1,`social networks`),
`typed/bookmarked`=ifelse(Referrer.Type=="typed/bookmarked",`typed/bookmarked`+1,`typed/bookmarked`))%>%
mutate(channel_level=ifelse(`missing`>0&`other web sites`==0&`search engines`==0&`social networks`==0&`typed/bookmarked`==0,"missing",
ifelse(`missing`==0&`other web sites`>0&`search engines`==0&`social networks`==0&`typed/bookmarked`==0,'other web sites',
ifelse(`missing`==0&`other web sites`==0&`search engines`>0&`social networks`==0&`typed/bookmarked`==0,'search engines',
ifelse(`missing`==0&`other web sites`==0&`search engines`==0&`social networks`>0&`typed/bookmarked`==0,'social networks',
ifelse(`missing`==0&`other web sites`==0&`search engines`==0&`social networks`==0&`typed/bookmarked`>0,'typed/bookmarked','Multi-channel'))))))%>%
group_by(channel_level,product)%>%
summarise(x=mean(total_days))%>%
ggplot(aes(channel_level,x,fill=product))+geom_bar(stat="identity",position="dodge")+theme_minimal()+coord_flip()+labs("Avg. Days to Order")
MH_aggregated%>%
mutate(missing=ifelse(Referrer.Type=="missing",missing+1,missing),
`other web sites`=ifelse(Referrer.Type=="other web sites",`other web sites`+1,`other web sites`),
`search engines`=ifelse(Referrer.Type=="search engines",`search engines`+1,`search engines`),
`social networks`=ifelse(Referrer.Type=="social networks",`social networks`+1,`social networks`),
`typed/bookmarked`=ifelse(Referrer.Type=="typed/bookmarked",`typed/bookmarked`+1,`typed/bookmarked`))%>%
mutate(channel_level=ifelse(`missing`>0&`other web sites`==0&`search engines`==0&`social networks`==0&`typed/bookmarked`==0,"missing",
ifelse(`missing`==0&`other web sites`>0&`search engines`==0&`social networks`==0&`typed/bookmarked`==0,'other web sites',
ifelse(`missing`==0&`other web sites`==0&`search engines`>0&`social networks`==0&`typed/bookmarked`==0,'search engines',
ifelse(`missing`==0&`other web sites`==0&`search engines`==0&`social networks`>0&`typed/bookmarked`==0,'social networks',
ifelse(`missing`==0&`other web sites`==0&`search engines`==0&`social networks`==0&`typed/bookmarked`>0,'typed/bookmarked','Multi-channel'))))))%>%
group_by(channel_level,product)%>%
summarise(x=mean(total_days))%>%
ggplot(aes(channel_level,x,fill=product))+geom_bar(stat="identity",position="dodge")+theme_minimal()+coord_flip()+labs(x="Avg. Days to Order")
MH_aggregated%>%
mutate(missing=ifelse(Referrer.Type=="missing",missing+1,missing),
`other web sites`=ifelse(Referrer.Type=="other web sites",`other web sites`+1,`other web sites`),
`search engines`=ifelse(Referrer.Type=="search engines",`search engines`+1,`search engines`),
`social networks`=ifelse(Referrer.Type=="social networks",`social networks`+1,`social networks`),
`typed/bookmarked`=ifelse(Referrer.Type=="typed/bookmarked",`typed/bookmarked`+1,`typed/bookmarked`))%>%
mutate(channel_level=ifelse(`missing`>0&`other web sites`==0&`search engines`==0&`social networks`==0&`typed/bookmarked`==0,"missing",
ifelse(`missing`==0&`other web sites`>0&`search engines`==0&`social networks`==0&`typed/bookmarked`==0,'other web sites',
ifelse(`missing`==0&`other web sites`==0&`search engines`>0&`social networks`==0&`typed/bookmarked`==0,'search engines',
ifelse(`missing`==0&`other web sites`==0&`search engines`==0&`social networks`>0&`typed/bookmarked`==0,'social networks',
ifelse(`missing`==0&`other web sites`==0&`search engines`==0&`social networks`==0&`typed/bookmarked`>0,'typed/bookmarked','Multi-channel'))))))%>%
group_by(channel_level,product)%>%
summarise(x=mean(total_days))%>%
ggplot(aes(channel_level,x,fill=product))+geom_bar(stat="identity",position="dodge")+theme_minimal()+coord_flip()+labs(y="Avg. Days to Order")
MH_aggregated
MH_aggregated%>%
mutate(missing=ifelse(Referrer.Type=="missing",missing+1,missing),
`other web sites`=ifelse(Referrer.Type=="other web sites",`other web sites`+1,`other web sites`),
`search engines`=ifelse(Referrer.Type=="search engines",`search engines`+1,`search engines`),
`social networks`=ifelse(Referrer.Type=="social networks",`social networks`+1,`social networks`),
`typed/bookmarked`=ifelse(Referrer.Type=="typed/bookmarked",`typed/bookmarked`+1,`typed/bookmarked`))%>%
mutate(channel_level=ifelse(`missing`>0&`other web sites`==0&`search engines`==0&`social networks`==0&`typed/bookmarked`==0,"missing",
ifelse(`missing`==0&`other web sites`>0&`search engines`==0&`social networks`==0&`typed/bookmarked`==0,'other web sites',
ifelse(`missing`==0&`other web sites`==0&`search engines`>0&`social networks`==0&`typed/bookmarked`==0,'search engines',
ifelse(`missing`==0&`other web sites`==0&`search engines`==0&`social networks`>0&`typed/bookmarked`==0,'social networks',
ifelse(`missing`==0&`other web sites`==0&`search engines`==0&`social networks`==0&`typed/bookmarked`>0,'typed/bookmarked','Multi-channel'))))))%>%
group_by(channel_level,product,visitor_access_level)%>%
summarise(n=n_distinct(uid_max))%>%
mutate(total=sum(n))%>%
mutate(prop=round(n/total*100,1))%>%
ggplot(aes(channel_level,prop,fill=product))+geom_bar(stat="identity",position="dodge")+theme_minimal()+coord_flip()+labs(x="Channel Segment")+facet_wrap(vars(visitor_access_level))
MH_aggregated%>%
mutate(visitor_access_level=ifelse(visitor_access_level==3,"subscribed",
ifelse(visitor_access_level==1,"Reg","anonymous")))%>%
mutate(missing=ifelse(Referrer.Type=="missing",missing+1,missing),
`other web sites`=ifelse(Referrer.Type=="other web sites",`other web sites`+1,`other web sites`),
`search engines`=ifelse(Referrer.Type=="search engines",`search engines`+1,`search engines`),
`social networks`=ifelse(Referrer.Type=="social networks",`social networks`+1,`social networks`),
`typed/bookmarked`=ifelse(Referrer.Type=="typed/bookmarked",`typed/bookmarked`+1,`typed/bookmarked`))%>%
mutate(channel_level=ifelse(`missing`>0&`other web sites`==0&`search engines`==0&`social networks`==0&`typed/bookmarked`==0,"missing",
ifelse(`missing`==0&`other web sites`>0&`search engines`==0&`social networks`==0&`typed/bookmarked`==0,'other web sites',
ifelse(`missing`==0&`other web sites`==0&`search engines`>0&`social networks`==0&`typed/bookmarked`==0,'search engines',
ifelse(`missing`==0&`other web sites`==0&`search engines`==0&`social networks`>0&`typed/bookmarked`==0,'social networks',
ifelse(`missing`==0&`other web sites`==0&`search engines`==0&`social networks`==0&`typed/bookmarked`>0,'typed/bookmarked','Multi-channel'))))))%>%
group_by(channel_level,product,visitor_access_level)%>%
summarise(n=n_distinct(uid_max))%>%
mutate(total=sum(n))%>%
mutate(prop=round(n/total*100,1))%>%
ggplot(aes(channel_level,prop,fill=product))+geom_bar(stat="identity",position="dodge")+theme_minimal()+coord_flip()+labs(x="Channel Segment")+facet_wrap(vars(visitor_access_level))
MH_aggregated%>%
mutate(visitor_access_level=ifelse(visitor_access_level==3,"subscribed",
ifelse(visitor_access_level==1,"Reg","anonymous")))%>%
mutate(missing=ifelse(Referrer.Type=="missing",missing+1,missing),
`other web sites`=ifelse(Referrer.Type=="other web sites",`other web sites`+1,`other web sites`),
`search engines`=ifelse(Referrer.Type=="search engines",`search engines`+1,`search engines`),
`social networks`=ifelse(Referrer.Type=="social networks",`social networks`+1,`social networks`),
`typed/bookmarked`=ifelse(Referrer.Type=="typed/bookmarked",`typed/bookmarked`+1,`typed/bookmarked`))%>%
mutate(channel_level=ifelse(`missing`>0&`other web sites`==0&`search engines`==0&`social networks`==0&`typed/bookmarked`==0,"missing",
ifelse(`missing`==0&`other web sites`>0&`search engines`==0&`social networks`==0&`typed/bookmarked`==0,'other web sites',
ifelse(`missing`==0&`other web sites`==0&`search engines`>0&`social networks`==0&`typed/bookmarked`==0,'search engines',
ifelse(`missing`==0&`other web sites`==0&`search engines`==0&`social networks`>0&`typed/bookmarked`==0,'social networks',
ifelse(`missing`==0&`other web sites`==0&`search engines`==0&`social networks`==0&`typed/bookmarked`>0,'typed/bookmarked','Multi-channel'))))))%>%
group_by(channel_level,product,visitor_access_level)%>%
summarise(n=n_distinct(uid_max))%>%
ungroup()
MH_aggregated%>%
mutate(visitor_access_level=ifelse(visitor_access_level==3,"subscribed",
ifelse(visitor_access_level==1,"Reg","anonymous")))%>%
mutate(missing=ifelse(Referrer.Type=="missing",missing+1,missing),
`other web sites`=ifelse(Referrer.Type=="other web sites",`other web sites`+1,`other web sites`),
`search engines`=ifelse(Referrer.Type=="search engines",`search engines`+1,`search engines`),
`social networks`=ifelse(Referrer.Type=="social networks",`social networks`+1,`social networks`),
`typed/bookmarked`=ifelse(Referrer.Type=="typed/bookmarked",`typed/bookmarked`+1,`typed/bookmarked`))%>%
mutate(channel_level=ifelse(`missing`>0&`other web sites`==0&`search engines`==0&`social networks`==0&`typed/bookmarked`==0,"missing",
ifelse(`missing`==0&`other web sites`>0&`search engines`==0&`social networks`==0&`typed/bookmarked`==0,'other web sites',
ifelse(`missing`==0&`other web sites`==0&`search engines`>0&`social networks`==0&`typed/bookmarked`==0,'search engines',
ifelse(`missing`==0&`other web sites`==0&`search engines`==0&`social networks`>0&`typed/bookmarked`==0,'social networks',
ifelse(`missing`==0&`other web sites`==0&`search engines`==0&`social networks`==0&`typed/bookmarked`>0,'typed/bookmarked','Multi-channel'))))))%>%
group_by(channel_level,product,visitor_access_level)%>%
summarise(n=n_distinct(uid_max))%>%
ungroup()%>%
group_by(channel_level,visitor_access_level)%>%
mutate(total=sum(n))
MH_aggregated%>%
mutate(visitor_access_level=ifelse(visitor_access_level==3,"subscribed",
ifelse(visitor_access_level==1,"Reg","anonymous")))%>%
mutate(missing=ifelse(Referrer.Type=="missing",missing+1,missing),
`other web sites`=ifelse(Referrer.Type=="other web sites",`other web sites`+1,`other web sites`),
`search engines`=ifelse(Referrer.Type=="search engines",`search engines`+1,`search engines`),
`social networks`=ifelse(Referrer.Type=="social networks",`social networks`+1,`social networks`),
`typed/bookmarked`=ifelse(Referrer.Type=="typed/bookmarked",`typed/bookmarked`+1,`typed/bookmarked`))%>%
mutate(channel_level=ifelse(`missing`>0&`other web sites`==0&`search engines`==0&`social networks`==0&`typed/bookmarked`==0,"missing",
ifelse(`missing`==0&`other web sites`>0&`search engines`==0&`social networks`==0&`typed/bookmarked`==0,'other web sites',
ifelse(`missing`==0&`other web sites`==0&`search engines`>0&`social networks`==0&`typed/bookmarked`==0,'search engines',
ifelse(`missing`==0&`other web sites`==0&`search engines`==0&`social networks`>0&`typed/bookmarked`==0,'social networks',
ifelse(`missing`==0&`other web sites`==0&`search engines`==0&`social networks`==0&`typed/bookmarked`>0,'typed/bookmarked','Multi-channel'))))))%>%
group_by(channel_level,product,visitor_access_level)%>%
summarise(n=n_distinct(uid_max))%>%
ungroup()%>%
group_by(channel_level,visitor_access_level)%>%
mutate(total=sum(n))%>%
mutate(prop=round(n/total*100,1))%>%
ggplot(aes(channel_level,prop,fill=product))+geom_bar(stat="identity",position="dodge")+theme_minimal()+coord_flip()+labs(x="Channel Segment")+facet_wrap(vars(visitor_access_level))
full_mh_set
gc()
mh_full_set_channel_aggregation
mh_model_2 <- brm(
bf(product~visitor_access_level+total_days+channel_level+last_touch_referrer),
data = mh_full_set_channel_aggregation,
family = "categorical",
chains = CHAINS, warmup = WARMUP, iter = ITER, seed = BAYES_SEED,
refresh = 0
)
mh_full_set_channel_aggregation
fit_aggregated<-multinom(product ~ ., data = mh_full_set_channel_aggregation)
fit_basic <- multinom(product ~ ., data = train_set)
fit_aggregated
tidy(fit_aggregated)
anova(fit_aggregated,fit_basic)
fit_basic <- multinom(product ~ ., data = full_mh_set)
anova(fit_aggregated,fit_basic)
fit_aggregated<-multinom(product ~ ., data = mh_full_set_channel_aggregation)
tidy(fit_aggregated)
BIC(fit_aggregated,fit_basic)
aic(fit_aggregated,fit_basic)
AIC(fit_aggregated,fit_basic)
mh_model_1
conditional_smooths(mh_model_1)
conditional_effects(mh_model_1)
pp_check(mh_model_1,ndraws=100)
pp_check(mh_model_1,ndraws=1000)
conditional_effects(mh_model_1,categorical=TRUE)
plot_predictions(mh_model_1,condition="total_days")
saveRDS(mh_model_1,"mh_categorical_model_1.rds")
write.csv(MH_aggregated,"MH_Aggregated_Use_This_For_Analysis.csv")
library(tidyverse)
library(utils)
remove.packages()
remove.packages(insight)
remove.packages("insight")
install.packages("insight")
library(tidyverse)
library(readr)
library(DBI)
library(RPostgres)
library(tidyverse)
library(DBI)
library(RPostgres)
library(ggplot2)
library(cmdstanr)
library(rstan)
library(StanHeaders)
library(rstantools)
library(tidybayes)
library(brms)
library(scales)
library(zoo)
library(ggpubr)
library(marginaleffects)
CHAINS <- 4
ITER <- 2000
WARMUP <- 1000
BAYES_SEED <- 1234
MH_aggregated<-read.csv("MH_Aggregated_Use_This_For_Analysis.csv")
mh_model_1<-readRDS("mh_categorical_model_1.rds")
plot_predictions(mh_model_1,condition="total_days")
plot_predictions(mh_model_1,condition=c("total_days","visitor_access_level"),type="probs")
library(ggplot2)
plot_predictions(mh_model_1,condition=c("total_days","visitor_access_level"),type="probs")
library(nnet)
plot_predictions(mh_model_1,condition=c("total_days","visitor_access_level"),type="probs")
pred<-predictions(mh_model_1)
draws <- posterior_draws(pred)
draws
ggplot(draws, aes(x = draw, fill = group)) +
geom_density(alpha = .2, color = "white") +
labs(x = "Predicted probability",
y = "Density",
fill = "Product")
plot_predictions(mh_model_1, condition = "last_touch_referrer") +
facet_wrap(~ product) +
labs(y = "Predicted probability")
plot_predictions(mh_model_1, condition = c("last_touch_referrer","search_engine")) +
facet_wrap(~ product) +
labs(y = "Predicted probability")
plot_predictions(mh_model_1, condition = c("last_touch_referrer","search_engines")) +
facet_wrap(~ product) +
labs(y = "Predicted probability")
plot_predictions(mh_model_1, condition = c("last_touch_referrer","visitor_access_level")) +
facet_wrap(~ product) +
labs(y = "Predicted probability")
plot_predictions(mh_model_1, condition = c("last_touch_referrer","visitor_access_level")) +
facet_wrap(~ group) +
labs(y = "Predicted probability")
plot_predictions(mh_model_1, condition = c("last_touch_referrer","visitor_access_level")) +
facet_wrap(~ group) +
labs(y = "Predicted probability")
plot_predictions(mh_model_1, condition = c("total_days")) +
facet_wrap(~ group) +
labs(y = "Predicted probability")
(y = "Predicted probability")
plot_predictions(mh_model_1, condition = c("total_days")) +
facet_wrap(~ group) +
labs(y = "Predicted probability")
plot_predictions(mh_model_1, condition = c("total_days","last_touch_referrer")) +
facet_wrap(~ group) +
labs(y = "Predicted probability")
plot_predictions(mh_model_1, condition = c("total_days","last_touch_referrer","visitor_access_level")) +
facet_wrap(~ group) +
labs(y = "Predicted probability")
plot_predictions(mh_model_1, condition = c("last_touch_referrer","visitor_access_level")) +
facet_wrap(~ group) +
labs(y = "Predicted probability")
library(tidyverse)
library(readr)
library(DBI)
library(RPostgres)
library(tidyverse)
library(DBI)
library(RPostgres)
library(ggplot2)
library(cmdstanr)
library(rstan)
library(StanHeaders)
library(rstantools)
library(tidybayes)
library(brms)
library(scales)
library(zoo)
library(ggpubr)
library(marginaleffects)
CHAINS <- 4
ITER <- 2000
WARMUP <- 1000
BAYES_SEED <- 1234
MH_aggregated<-read.csv("MH_Aggregated_Use_This_For_Analysis.csv")
full_mh_set_no_print<-MH_aggregated%>%
mutate(visitor_access_level=ifelse(visitor_access_level==3,"subscribed",
ifelse(visitor_access_level==1,"Reg","anonymous")))%>%
mutate(product=ifelse(product=="Print Only","Digital and Print",product))%>%
mutate(visitor_access_level=as.factor(visitor_access_level),
product=as.factor(product),
last_touch_referrer=as.factor(Referrer.Type))%>%
mutate(other_web_sites=`other.web.sites`,
search_engines=`search.engines`,
social_networks=`social.networks`,
typed_bookmarked=`typed.bookmarked`)%>%
filter(!(Referrer.Type=="missing"&social.networks==0&typed_bookmarked==0&search.engines==0&other.web.sites==0))%>%
select(visitor_access_level,total_days,missing,other_web_sites,search_engines,social_networks,typed_bookmarked,last_touch_referrer,product)
mh_model_2_int_brms<-readRDS("mh_categorical_model_2_int.rds")
mh_model_2_int_brms
post_data<-full_mh_set_no_print%>%
add_fitted_draws(mh_model_2_int_brms,n=1000,re_formula=NA)
post_data%>%
mutate(total_day_category=ifelse(total_days==1,"One Day",
ifelse(total_days>1&total_days<=5,"2 - 5 Days","6 Days +")))%>%
mutate(total_day_category=factor(total_day_category,levels=c("One Day","2 - 5 Days","6 Days +")))%>%
group_by(visitor_access_level,total_day_category,.category)%>%
summarise(mean_value=round(mean(.value)*100,1))%>%
ungroup()%>%
ggplot(aes(y=mean_value,x=total_day_category,color=.category,group=.category))+geom_point(alpha=0.4)+geom_line()+
facet_wrap(~visitor_access_level)+theme(axis.text.x = element_text(angle = 90,vjust=-0.5),panel.background = element_rect(fill = "white", colour = "grey50"))+geom_text(aes(label=paste(mean_value,"%",sep="")),position=position_dodge(width=1),size=3,vjust=-0.5)+labs(y="Proability of Purchasing",x="Total Days Visited",color="Product Outcome")
post_data%>%
mutate(total_day_category=ifelse(total_days==1,"One Day",
ifelse(total_days>1&total_days<=5,"2 - 5 Days","6 Days +")))%>%
mutate(total_day_category=factor(total_day_category,levels=c("One Day","2 - 5 Days","6 Days +")))%>%
group_by(visitor_access_level,total_day_category,.category)%>%
summarise(mean_value=round(mean(.value)*100,1))%>%
ungroup()%>%
ggplot(aes(y=mean_value,x=total_day_category,color=.category,group=.category))+geom_point(alpha=0.4)+geom_line()+
facet_wrap(~visitor_access_level)+theme(axis.text.x = element_text(angle = 90,vjust=-0.5),panel.background = element_rect(fill = "white", colour = "grey50"))+geom_text(aes(label=paste(mean_value,"%",sep="")),position=position_dodge(width=1),size=3,vjust=-0.5)+labs(y="Proability of Purchasing",x="Total Days Visited",color="Product Outcome")
