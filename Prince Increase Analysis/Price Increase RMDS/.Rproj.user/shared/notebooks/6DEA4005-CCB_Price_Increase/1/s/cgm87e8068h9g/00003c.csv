"0","ccb_working_query%>%
  filter(donortype==""I"")%>%
  group_by(subscriptionid)%>%
  arrange(start_date,.by_group=TRUE)%>%
  mutate(adv_sub_id=as.numeric(adv_sub_id))%>%
  select(-c(test,position,test2))%>%
  mutate(ordernumber=as.character(ordernumber))%>%
  left_join(last_term,by=c(""adv_sub_id""=""subscriptionreference"",""adv_order_number""=""ordernumber""))%>%
  separate(start_date,into=c(""start_date"",""start_time""),sep="" "")%>%
  separate(orderdate,into=c(""order_date"",""order_time""),sep="" "")%>%
  separate(expire_date,into=c(""expire_date"",""expire_time""),sep="" "")%>%
  mutate(order_date=ifelse(is.na(order_date),start_date,order_date))%>%
  mutate(order_date=as.Date(order_date,format=""%Y-%m-%d""))%>%
  mutate(start_date=as.Date(start_date,format=""%Y-%m-%d""))%>%
  mutate(expire_date=as.Date(expire_date,format=""%Y-%m-%d""))%>%
  mutate(termnumber=row_number()-1)%>%
  mutate(termnumber=ifelse(f==start_date,m,termnumber+m))%>%
  select(subscriptionid,ordernumber,customeraccountid,termnumber,termlength,isautorenew,totalprice,publicationcode,donortype,start_date,expire_date,rate,order_date)%>%
  arrange(start_date,.by_group=TRUE)%>%
  mutate(termnumber=ifelse(is.na(termnumber),row_number(),termnumber))%>%
  mutate(renewaltermnumber=lead(termnumber,order_by=c(subscriptionid,start_date)),
         renewalrate=lead(rate,order_by=c(subscriptionid,start_date)),
         renewalpublicationcode=lead(publicationcode,order_by=c(subscriptionid,start_date)),
         renewalorderdate=lead(order_date,order_by=c(subscriptionid,start_date)),
         renewalstartdate=lead(start_date,order_by=c(subscriptionid,start_date)),
         renewaltermlength=lead(termlength,order_by=c(subscriptionid,start_date)))
"
"2","Warning:"
"2"," [38;5;232mExpected 2 pieces. Missing pieces filled with `NA` in 145579 rows [6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16,
17, 18, 19, 20, 21, 22, 23, 26, 27, ...].[39m
"
"2","Warning:"
"2"," [38;5;232mExpected 2 pieces. Missing pieces filled with `NA` in 149335 rows [6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16,
17, 18, 19, 20, 21, 22, 23, 24, 25, ...].[39m
"
"1","[1m[33mError[39m in `mutate()`:[22m
[38;5;232m[36mâ„¹[38;5;232m In argument: `renewaltermnumber = lead(termnumber, order_by = c(subscriptionid, start_date))`.
[36mâ„¹[38;5;232m In group 1: `subscriptionid = 906114`.[39m
[1mCaused by error in `UseMethod()`:[22m
[33m![39m no applicable method for 'as.integer64' applied to an object of class ""Date""
Backtrace:
[90m  1. [39m... %>% ...
[90m 12. [39mbit64::c.integer64(subscriptionid, start_date)
[90m 13. [39mbit64::as.integer64(l[[k]])
"
