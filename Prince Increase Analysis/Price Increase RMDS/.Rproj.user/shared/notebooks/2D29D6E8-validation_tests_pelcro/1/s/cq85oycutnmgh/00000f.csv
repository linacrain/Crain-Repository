"0","reduced_list_city<-city_brand_table%>%"
"0","  filter(donortype==""I"")%>%"
"0","  filter(subscriptionclass==""R"")%>%"
"0","  filter(termtype%in%c(""P"",""C""))%>%"
"0","  filter(expirationissuedate>=as.Date(""2016-01-01"",format=""%Y-%m-%d""))"
"0",""
"0","ccl_table<-reduced_list_city%>%"
"0","  filter(brand==""CL"")%>%"
"0","  crossing(date_index)%>%"
"0","  mutate(termlength=as.numeric(termlength))%>%"
"0","  mutate(rate_per_day=((rate/termlength)/7)*copies)%>%"
"0","  filter(rate>0)%>%"
"0","  mutate(p_start_date=if_else(startissuedate<start_date,start_date,startissuedate),"
"0","         p_end_date=if_else(expirationissuedate>end_date,end_date,expirationissuedate))%>%"
"0","  mutate(total_days_this_week=as.numeric(difftime(p_end_date,p_start_date,units=""days"")))%>%"
"0","  filter(total_days_this_week>0&total_days_this_week<=7)%>%"
"0","  mutate(weekly_recognized_revenue=rate_per_day*total_days_this_week)%>%"
"0","  group_by(start_date)%>%"
"0","  summarise(total_recognized_weekly_revenue=sum(weekly_recognized_revenue),"
"0","            distinct_contracts=n_distinct(paste(shiptocustomernumber,ordernumber,adv_subid)),"
"0","            distinct_subscriptions=n_distinct(adv_subid),"
"0","            total_copies=sum(copies)"
"0","            )"
"0",""
"0","ccb_table<-reduced_list_city%>%"
"0","  filter(brand==""CB"")%>%"
"0","  crossing(date_index)%>%"
"0","  mutate(termlength=as.numeric(termlength))%>%"
"0","  mutate(rate_per_day=((rate/termlength)/7)*copies)%>%"
"0","  filter(rate>0)%>%"
"0","  mutate(p_start_date=if_else(startissuedate<start_date,start_date,startissuedate),"
"0","         p_end_date=if_else(expirationissuedate>end_date,end_date,expirationissuedate))%>%"
"0","  mutate(total_days_this_week=as.numeric(difftime(p_end_date,p_start_date,units=""days"")))%>%"
"0","  filter(total_days_this_week>0&total_days_this_week<=7)%>%"
"0","  mutate(weekly_recognized_revenue=rate_per_day*total_days_this_week)%>%"
"0","  group_by(start_date)%>%"
"0","  summarise(total_recognized_weekly_revenue=sum(weekly_recognized_revenue),"
"0","            distinct_contracts=n_distinct(paste(shiptocustomernumber,ordernumber,adv_subid)),"
"0","            distinct_subscriptions=n_distinct(adv_subid),"
"0","            total_copies=sum(copies)"
"0","            )"
"0",""
"0","cdb_table<-reduced_list_city%>%"
"0","  filter(brand==""CD"")%>%"
"0","  crossing(date_index)%>%"
"0","  mutate(termlength=as.numeric(termlength))%>%"
"0","  mutate(rate_per_day=((rate/termlength)/7)*copies)%>%"
"0","  filter(rate>0)%>%"
"0","  mutate(p_start_date=if_else(startissuedate<start_date,start_date,startissuedate),"
"0","         p_end_date=if_else(expirationissuedate>end_date,end_date,expirationissuedate))%>%"
"0","  mutate(total_days_this_week=as.numeric(difftime(p_end_date,p_start_date,units=""days"")))%>%"
"0","  filter(total_days_this_week>0&total_days_this_week<=7)%>%"
"0","  mutate(weekly_recognized_revenue=rate_per_day*total_days_this_week)%>%"
"0","  group_by(start_date)%>%"
"0","  summarise(total_recognized_weekly_revenue=sum(weekly_recognized_revenue),"
"0","            distinct_contracts=n_distinct(paste(shiptocustomernumber,ordernumber,adv_subid)),"
"0","            distinct_subscriptions=n_distinct(adv_subid),"
"0","            total_copies=sum(copies)"
"0","            )"
"0",""
"0","cny_table<-reduced_list_city%>%"
"0","  filter(brand==""CN"")%>%"
"0","  crossing(date_index)%>%"
"0","  mutate(termlength=as.numeric(termlength))%>%"
"0","  mutate(rate_per_day=((rate/termlength)/7)*copies)%>%"
"0","  filter(rate>0)%>%"
"0","  mutate(p_start_date=if_else(startissuedate<start_date,start_date,startissuedate),"
"0","         p_end_date=if_else(expirationissuedate>end_date,end_date,expirationissuedate))%>%"
"0","  mutate(total_days_this_week=as.numeric(difftime(p_end_date,p_start_date,units=""days"")))%>%"
"0","  filter(total_days_this_week>0&total_days_this_week<=7)%>%"
"0","  mutate(weekly_recognized_revenue=rate_per_day*total_days_this_week)%>%"
"0","  group_by(start_date)%>%"
"0","  summarise(total_recognized_weekly_revenue=sum(weekly_recognized_revenue),"
"0","            distinct_contracts=n_distinct(paste(shiptocustomernumber,ordernumber,adv_subid)),"
"0","            distinct_subscriptions=n_distinct(adv_subid),"
"0","            total_copies=sum(copies)"
"0","            )"
