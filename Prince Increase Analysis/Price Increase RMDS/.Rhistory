pelcro%>%
filter(subscriptionid==1938644)
pelcro_invoice%>%
filter(!susbcriptionid%in%an_query$pelcro_subid)%>%
filter(!str_detect(currency,'cad'))%>%
select(susbcriptionid)
pelcro_invoice%>%
filter(!susbcriptionid%in%an_query$pelcro_subid)%>%
filter(!str_detect(currency,'cad'))
select(susbcriptionid)
pelcro_invoice%>%
filter(!susbcriptionid%in%an_query$pelcro_subid)%>%
filter(!str_detect(currency,'cad'))
an_query%>%
filter(donortype=="I")%>%
filter(orderdate>=as.Date("12/15/2023",format="%m/%d/%Y")&termnumber==1)%>%
filter(pubcode=="Basic Digital"|pubcode=="Premium")%>%
mutate(pubcode=ifelse(pubcode=="AN3","Digital All Access",pubcode))%>%
mutate(termnumber=as.numeric(termnumber))%>%
group_by(shiptocustomernumber,ordernumber,pelcro_subid,isautorenew,pubcode,termnumber,termlength,rate,startissuedate,expirationissuedate)%>%
summarise(renewalrate=max(renewalrate),
renewalordernumber=n_distinct(renewalordernumber,na.rm=TRUE))%>%
ungroup()%>%
group_by(pubcode,termlength,isautorenew)%>%
summarise(n_distinct_contracts=n_distinct(paste(shiptocustomernumber,ordernumber,pelcro_subid)),
n_distinct_renewals=n_distinct(ifelse(renewalordernumber>0,paste(shiptocustomernumber,ordernumber,pelcro_subid),NA),na.rm=TRUE),
n_distinct_undetermined_contracts=n_distinct(ifelse(renewalordernumber==0&expirationissuedate>=today(),paste(shiptocustomernumber,ordernumber,pelcro_subid),NA),na.rm=TRUE),
n_distinct_churned=n_distinct(ifelse(renewalordernumber==0&expirationissuedate<today(),paste(shiptocustomernumber,ordernumber,pelcro_subid),NA),na.rm=TRUE),
mean_rate_renewal_price_increase=mean(ifelse(renewalordernumber>0,rate,NA),na.rm=TRUE),
mean_rate_churn_price_increase=mean(ifelse(renewalordernumber>0,NA,rate),na.rm=TRUE),
median_rate_renewal_price_increase=median(ifelse(renewalordernumber>0,rate,NA),na.rm=TRUE),
median_rate_churn_price_increase=median(ifelse(renewalordernumber>0,NA,rate),na.rm=TRUE),
initial_new_user_revenue=sum(rate))
an_query%>%
filter(donortype=="I")%>%
filter(orderdate<as.Date("12-15-2023",format="%m-%d-%Y"))%>%
filter(pubcode=="Basic Digital"|pubcode=="Premium")%>%
mutate(pubcode=ifelse(pubcode=="AN3","Digital All Access",pubcode))%>%
mutate(termnumber=as.numeric(termnumber))%>%
filter(termnumber==1)
an_query%>%
filter(donortype=="I")%>%
filter(orderdate<as.Date("12-15-2023",format="%m-%d-%Y"))%>%
filter(orderdate>as.Date("05-01-2023",format='%m-%d-%Y'))%>%
filter(pubcode=="Basic Digital"|pubcode=="Premium")%>%
mutate(pubcode=ifelse(pubcode=="AN3","Digital All Access",pubcode))%>%
mutate(termnumber=as.numeric(termnumber))%>%
filter(termnumber==1)
group_by(shiptocustomernumber,ordernumber,orderdate,pelcro_subid,isautorenew,pubcode,termnumber,termlength,rate,expirationissuedate)%>%
summarise(renewalrate=max(renewalrate),
renewalordernumber=n_distinct(renewalordernumber,na.rm=TRUE))%>%
ungroup()%>%
group_by(pubcode,isautorenew)%>%
filter(rate==199|rate==20)
an_query%>%
filter(donortype=="I")%>%
filter(orderdate<as.Date("12-15-2023",format="%m-%d-%Y"))%>%
filter(orderdate>as.Date("05-01-2023",format='%m-%d-%Y'))%>%
filter(pubcode=="Basic Digital"|pubcode=="Premium")%>%
mutate(pubcode=ifelse(pubcode=="AN3","Digital All Access",pubcode))%>%
mutate(termnumber=as.numeric(termnumber))%>%
filter(termnumber==1)%>%
group_by(shiptocustomernumber,ordernumber,orderdate,pelcro_subid,isautorenew,pubcode,termnumber,termlength,rate,expirationissuedate)%>%
summarise(renewalrate=max(renewalrate),
renewalordernumber=n_distinct(renewalordernumber,na.rm=TRUE))%>%
ungroup()%>%
group_by(pubcode,isautorenew)%>%
filter(rate==199|rate==20)
an_query%>%
filter(donortype=="I")%>%
filter(orderdate<as.Date("12-15-2023",format="%m-%d-%Y"))%>%
filter(orderdate>as.Date("05-01-2023",format='%m-%d-%Y'))%>%
filter(pubcode=="Basic Digital"|pubcode=="Premium")%>%
mutate(pubcode=ifelse(pubcode=="AN3","Digital All Access",pubcode))%>%
mutate(termnumber=as.numeric(termnumber))%>%
filter(termnumber==1)%>%
group_by(shiptocustomernumber,ordernumber,orderdate,pelcro_subid,isautorenew,pubcode,termnumber,termlength,rate,expirationissuedate)%>%
summarise(renewalrate=max(renewalrate),
renewalordernumber=n_distinct(renewalordernumber,na.rm=TRUE))%>%
ungroup()%>%
group_by(pubcode,isautorenew)%>%
filter(rate==199|rate==20)
an_query%>%
filter(donortype=="I")%>%
filter(orderdate<as.Date("12-15-2023",format="%m-%d-%Y"))%>%
filter(orderdate>as.Date("05-01-2023",format='%m-%d-%Y'))%>%
filter(pubcode=="Basic Digital"|pubcode=="Premium")%>%
mutate(pubcode=ifelse(pubcode=="AN3","Digital All Access",pubcode))%>%
mutate(termnumber=as.numeric(termnumber))%>%
filter(termnumber==1)%>%
group_by(shiptocustomernumber,ordernumber,orderdate,pelcro_subid,isautorenew,pubcode,termnumber,termlength,rate,expirationissuedate)%>%
summarise(renewalrate=max(renewalrate),
renewalordernumber=n_distinct(renewalordernumber,na.rm=TRUE))%>%
ungroup()%>%
group_by(pubcode,isautorenew)%>%
filter(rate==199|rate==20)%>%
group_by(pubcode,termlength)%>%
summarise(n_contracts=n_distinct(paste(shiptocustomernumber,ordernumber,pelcro_subid)))
an_query%>%
filter(donortype=="I")%>%
filter(orderdate<as.Date("12-15-2023",format="%m-%d-%Y"))%>%
filter(orderdate>as.Date("05-01-2023",format='%m-%d-%Y'))%>%
filter(pubcode=="Basic Digital"|pubcode=="Premium")%>%
mutate(pubcode=ifelse(pubcode=="AN3","Digital All Access",pubcode))%>%
mutate(termnumber=as.numeric(termnumber))%>%
filter(termnumber==1)%>%
group_by(shiptocustomernumber,ordernumber,orderdate,pelcro_subid,isautorenew,pubcode,termnumber,termlength,rate,expirationissuedate)%>%
summarise(renewalrate=max(renewalrate),
renewalordernumber=n_distinct(renewalordernumber,na.rm=TRUE))%>%
ungroup()%>%
group_by(pubcode,isautorenew)%>%
filter(rate==199|rate==20)%>%
group_by(pubcode,termlength)%>%
summarise(n_contracts=n_distinct(paste(shiptocustomernumber,ordernumber,pelcro_subid)))%>%
mutate(total_contracts=sum(n_contracts))
an_query%>%
filter(donortype=="I")%>%
filter(orderdate<as.Date("12-15-2023",format="%m-%d-%Y"))%>%
filter(orderdate>as.Date("05-01-2023",format='%m-%d-%Y'))%>%
filter(pubcode=="Basic Digital"|pubcode=="Premium")%>%
mutate(pubcode=ifelse(pubcode=="AN3","Digital All Access",pubcode))%>%
mutate(termnumber=as.numeric(termnumber))%>%
filter(termnumber==1)%>%
group_by(shiptocustomernumber,ordernumber,orderdate,pelcro_subid,isautorenew,pubcode,termnumber,termlength,rate,expirationissuedate)%>%
summarise(renewalrate=max(renewalrate),
renewalordernumber=n_distinct(renewalordernumber,na.rm=TRUE))%>%
ungroup()%>%
group_by(pubcode,isautorenew)%>%
filter(rate==199|rate==20)%>%
group_by(pubcode,termlength)%>%
summarise(n_contracts=n_distinct(paste(shiptocustomernumber,ordernumber,pelcro_subid)),
avg_rate=mean(rate))%>%
mutate(total_contracts=sum(n_contracts))
an_query%>%
filter(donortype=="I")%>%
filter(orderdate<as.Date("12-15-2023",format="%m-%d-%Y"))%>%
filter(orderdate>as.Date("05-01-2023",format='%m-%d-%Y'))%>%
filter(pubcode=="Basic Digital"|pubcode=="Premium")%>%
mutate(pubcode=ifelse(pubcode=="AN3","Digital All Access",pubcode))%>%
mutate(termnumber=as.numeric(termnumber))%>%
filter(termnumber==1)%>%
group_by(shiptocustomernumber,ordernumber,orderdate,pelcro_subid,isautorenew,pubcode,termnumber,termlength,rate,expirationissuedate)%>%
summarise(renewalrate=max(renewalrate),
renewalordernumber=n_distinct(renewalordernumber,na.rm=TRUE))%>%
ungroup()%>%
group_by(pubcode,isautorenew)%>%
filter(rate==199|rate==20)%>%
group_by(pubcode,termlength)%>%
summarise(n_contracts=n_distinct(paste(shiptocustomernumber,ordernumber,pelcro_subid)))%>%
mutate(total_contracts=sum(n_contracts))
an_query%>%
filter(donortype=="I")%>%
filter(orderdate<as.Date("12-15-2023",format="%m-%d-%Y"))%>%
filter(orderdate>as.Date("05-01-2023",format='%m-%d-%Y'))%>%
filter(pubcode=="Basic Digital"|pubcode=="Premium")%>%
mutate(pubcode=ifelse(pubcode=="AN3","Digital All Access",pubcode))%>%
mutate(termnumber=as.numeric(termnumber))%>%
filter(termnumber==1)%>%
group_by(shiptocustomernumber,ordernumber,orderdate,pelcro_subid,isautorenew,pubcode,termnumber,termlength,rate,expirationissuedate)%>%
summarise(renewalrate=max(renewalrate),
renewalordernumber=n_distinct(renewalordernumber,na.rm=TRUE))%>%
ungroup()%>%
group_by(pubcode,isautorenew)%>%
filter(rate==199|rate==20)%>%
group_by(pubcode,termlength)%>%
summarise(n_contracts=n_distinct(paste(shiptocustomernumber,ordernumber,pelcro_subid)))%>%
ungroup()%>%
mutate(total_contracts=sum(n_contracts))
an_query%>%
filter(donortype=="I")%>%
filter(orderdate>=as.Date("12/15/2023",format="%m/%d/%Y")&termnumber==1)%>%
filter(pubcode=="Basic Digital"|pubcode=="Premium")%>%
mutate(pubcode=ifelse(pubcode=="AN3","Digital All Access",pubcode))%>%
mutate(termnumber=as.numeric(termnumber))%>%
group_by(shiptocustomernumber,ordernumber,pelcro_subid,isautorenew,pubcode,termnumber,termlength,rate,startissuedate,expirationissuedate)%>%
summarise(renewalrate=max(renewalrate),
renewalordernumber=n_distinct(renewalordernumber,na.rm=TRUE))%>%
ungroup()
an_query%>%
filter(donortype=="I")%>%
filter(orderdate>=as.Date("12/15/2023",format="%m/%d/%Y")&termnumber==1)%>%
filter(pubcode=="Basic Digital"|pubcode=="Premium")%>%
mutate(pubcode=ifelse(pubcode=="AN3","Digital All Access",pubcode))%>%
mutate(termnumber=as.numeric(termnumber))%>%
group_by(shiptocustomernumber,ordernumber,pelcro_subid,isautorenew,pubcode,termnumber,termlength,rate,startissuedate,expirationissuedate)%>%
summarise(renewalrate=max(renewalrate),
renewalordernumber=n_distinct(renewalordernumber,na.rm=TRUE))%>%
ungroup()%>%
group_by(pubcode,isautorenew)%>%
filter(rate==249|rate==25|rate==299)%>%
group_by(pubcode,termlength)%>%
summarise(n_contracts=n_distinct(paste(shiptocustomernumber,ordernumber,pelcro_subid)))%>%
ungroup()%>%
mutate(total_contracts=sum(n_contracts))
an_query%>%
filter(donortype=="I")%>%
filter(orderdate<as.Date("12-15-2023",format="%m-%d-%Y"))%>%
filter(orderdate>as.Date("05-01-2023",format='%m-%d-%Y'))%>%
filter(pubcode=="Basic Digital"|pubcode=="Premium")%>%
mutate(pubcode=ifelse(pubcode=="AN3","Digital All Access",pubcode))%>%
mutate(termnumber=as.numeric(termnumber))%>%
filter(termnumber==1)%>%
group_by(shiptocustomernumber,ordernumber,orderdate,pelcro_subid,isautorenew,pubcode,termnumber,termlength,rate,expirationissuedate)%>%
summarise(renewalrate=max(renewalrate),
renewalordernumber=n_distinct(renewalordernumber,na.rm=TRUE))%>%
ungroup()%>%
group_by(pubcode,isautorenew)%>%
filter(rate==199|rate==20)%>%
group_by(pubcode,termlength)%>%
summarise(n_contracts=n_distinct(paste(shiptocustomernumber,ordernumber,pelcro_subid)))%>%
ungroup()%>%
mutate(total_contracts=sum(n_contracts))%>%
mutate(prop=n_contracts/total_contracts)
an_query%>%
filter(donortype=="I")%>%
filter(orderdate<as.Date("12-15-2023",format="%m-%d-%Y"))%>%
filter(orderdate>as.Date("05-01-2023",format='%m-%d-%Y'))%>%
filter(pubcode=="Basic Digital"|pubcode=="Premium")%>%
mutate(pubcode=ifelse(pubcode=="AN3","Digital All Access",pubcode))%>%
mutate(termnumber=as.numeric(termnumber))%>%
filter(termnumber==1)%>%
group_by(shiptocustomernumber,ordernumber,orderdate,pelcro_subid,isautorenew,pubcode,termnumber,termlength,rate,expirationissuedate)%>%
summarise(renewalrate=max(renewalrate),
renewalordernumber=n_distinct(renewalordernumber,na.rm=TRUE))%>%
ungroup()%>%
group_by(pubcode,isautorenew)%>%
filter(rate==199|rate==20)%>%
group_by(pubcode,termlength)%>%
summarise(n_contracts=n_distinct(paste(shiptocustomernumber,ordernumber,pelcro_subid)))%>%
ungroup()%>%
mutate(total_contracts=sum(n_contracts))%>%
mutate(prop=round(n_contracts/total_contracts,2))
an_query%>%
filter(donortype=="I")%>%
filter(orderdate>=as.Date("12/15/2023",format="%m/%d/%Y")&termnumber==1)%>%
filter(pubcode=="Basic Digital"|pubcode=="Premium")%>%
mutate(pubcode=ifelse(pubcode=="AN3","Digital All Access",pubcode))%>%
mutate(termnumber=as.numeric(termnumber))%>%
group_by(shiptocustomernumber,ordernumber,pelcro_subid,isautorenew,pubcode,termnumber,termlength,rate,startissuedate,expirationissuedate)%>%
summarise(renewalrate=max(renewalrate),
renewalordernumber=n_distinct(renewalordernumber,na.rm=TRUE))%>%
ungroup()%>%
group_by(pubcode,isautorenew)%>%
filter(rate==249|rate==25|rate==299)%>%
group_by(pubcode,termlength)%>%
summarise(n_contracts=n_distinct(paste(shiptocustomernumber,ordernumber,pelcro_subid)))%>%
ungroup()%>%
mutate(total_contracts=sum(n_contracts))%>%
mutate(prop=round(n_contracts/total_contracts,2))
an_query%>%
filter(donortype=="I")%>%
filter(orderdate<as.Date("12-15-2023",format="%m-%d-%Y"))%>%
filter(orderdate>as.Date("05-01-2023",format='%m-%d-%Y'))%>%
filter(pubcode=="Basic Digital"|pubcode=="Premium")%>%
mutate(pubcode=ifelse(pubcode=="AN3","Digital All Access",pubcode))%>%
mutate(termnumber=as.numeric(termnumber))%>%
filter(termnumber==1)%>%
group_by(shiptocustomernumber,ordernumber,orderdate,pelcro_subid,isautorenew,pubcode,termnumber,termlength,rate,expirationissuedate)%>%
summarise(renewalrate=max(renewalrate),
renewalordernumber=n_distinct(renewalordernumber,na.rm=TRUE))%>%
ungroup()%>%
group_by(pubcode,isautorenew)%>%
filter(rate==199|rate==20)%>%
group_by(pubcode,termlength)%>%
summarise(n_contracts=n_distinct(paste(shiptocustomernumber,ordernumber,pelcro_subid)))%>%
ungroup()%>%
mutate(total_contracts=sum(n_contracts))%>%
mutate(prop=round(n_contracts/total_contracts,2))%>%
mutate(category="pre_2nd_price_increase")
an_query%>%
filter(donortype=="I")%>%
filter(orderdate>=as.Date("12/15/2023",format="%m/%d/%Y")&termnumber==1)%>%
filter(pubcode=="Basic Digital"|pubcode=="Premium")%>%
mutate(pubcode=ifelse(pubcode=="AN3","Digital All Access",pubcode))%>%
mutate(termnumber=as.numeric(termnumber))%>%
group_by(shiptocustomernumber,ordernumber,pelcro_subid,isautorenew,pubcode,termnumber,termlength,rate,startissuedate,expirationissuedate)%>%
summarise(renewalrate=max(renewalrate),
renewalordernumber=n_distinct(renewalordernumber,na.rm=TRUE))%>%
ungroup()%>%
group_by(pubcode,isautorenew)%>%
filter(rate==249|rate==25|rate==299)%>%
group_by(pubcode,termlength)%>%
summarise(n_contracts=n_distinct(paste(shiptocustomernumber,ordernumber,pelcro_subid)))%>%
ungroup()%>%
mutate(total_contracts=sum(n_contracts))%>%
mutate(prop=round(n_contracts/total_contracts,2))%>%
mutate(category="post_2nd_price_increase")
an_query%>%
filter(donortype=="I")%>%
filter(orderdate>=as.Date("12/15/2023",format="%m/%d/%Y")&termnumber==1)%>%
filter(pubcode=="Basic Digital"|pubcode=="Premium")%>%
mutate(pubcode=ifelse(pubcode=="AN3","Digital All Access",pubcode))%>%
mutate(termnumber=as.numeric(termnumber))%>%
group_by(shiptocustomernumber,ordernumber,pelcro_subid,isautorenew,pubcode,termnumber,termlength,rate,startissuedate,expirationissuedate)%>%
summarise(renewalrate=max(renewalrate),
renewalordernumber=n_distinct(renewalordernumber,na.rm=TRUE))%>%
ungroup()%>%
group_by(pubcode,isautorenew)%>%
filter(rate==249|rate==25|rate==299)%>%
group_by(pubcode,termlength)%>%
summarise(n_contracts=n_distinct(paste(shiptocustomernumber,ordernumber,pelcro_subid)))%>%
ungroup()%>%
mutate(total_contracts=sum(n_contracts))%>%
mutate(prop=round(n_contracts/total_contracts,2))%>%
mutate(category="post_2nd_price_increase")
pre_table<-an_query%>%
filter(donortype=="I")%>%
filter(orderdate<as.Date("12-15-2023",format="%m-%d-%Y"))%>%
filter(orderdate>as.Date("05-01-2023",format='%m-%d-%Y'))%>%
filter(pubcode=="Basic Digital"|pubcode=="Premium")%>%
mutate(pubcode=ifelse(pubcode=="AN3","Digital All Access",pubcode))%>%
mutate(termnumber=as.numeric(termnumber))%>%
filter(termnumber==1)%>%
group_by(shiptocustomernumber,ordernumber,orderdate,pelcro_subid,isautorenew,pubcode,termnumber,termlength,rate,expirationissuedate)%>%
summarise(renewalrate=max(renewalrate),
renewalordernumber=n_distinct(renewalordernumber,na.rm=TRUE))%>%
ungroup()%>%
group_by(pubcode,isautorenew)%>%
filter(rate==199|rate==20)%>%
group_by(pubcode,termlength)%>%
summarise(n_contracts=n_distinct(paste(shiptocustomernumber,ordernumber,pelcro_subid)))%>%
ungroup()%>%
mutate(total_contracts=sum(n_contracts))%>%
mutate(prop=round(n_contracts/total_contracts,2))%>%
mutate(category="pre_2nd_price_increase")
post_table<-an_query%>%
filter(donortype=="I")%>%
filter(orderdate>=as.Date("12/15/2023",format="%m/%d/%Y")&termnumber==1)%>%
filter(pubcode=="Basic Digital"|pubcode=="Premium")%>%
mutate(pubcode=ifelse(pubcode=="AN3","Digital All Access",pubcode))%>%
mutate(termnumber=as.numeric(termnumber))%>%
group_by(shiptocustomernumber,ordernumber,pelcro_subid,isautorenew,pubcode,termnumber,termlength,rate,startissuedate,expirationissuedate)%>%
summarise(renewalrate=max(renewalrate),
renewalordernumber=n_distinct(renewalordernumber,na.rm=TRUE))%>%
ungroup()%>%
group_by(pubcode,isautorenew)%>%
filter(rate==249|rate==25|rate==299)%>%
group_by(pubcode,termlength)%>%
summarise(n_contracts=n_distinct(paste(shiptocustomernumber,ordernumber,pelcro_subid)))%>%
ungroup()%>%
mutate(total_contracts=sum(n_contracts))%>%
mutate(prop=round(n_contracts/total_contracts,2))%>%
mutate(category="post_2nd_price_increase")
full_table<-union(pre_table,post_table)
full_table
library(brms)
premium_annual<-full_table%>%
filter(pubcode=="Premium"&termlength=="Annual")
premium_annual
ggplot() +
stat_function(fun = ~dbeta(., 4, 6), geom = "area",
aes(fill = "Beta(4, 6)"), alpha = 0.5)
ggplot() +
stat_function(fun = ~dbeta(., 8, 39), geom = "area",
aes(fill = "Beta(4, 6)"), alpha = 0.5)
ggplot() +
stat_function(fun = ~dbeta(., 8, 39), geom = "area",
aes(fill = "Beta(8, 39)"), alpha = 0.5)
ggplot() +
stat_function(fun = ~dbeta(., 80, 390), geom = "area",
aes(fill = "Beta(8, 39)"), alpha = 0.5)
ggplot() +
stat_function(fun = ~dbeta(., 8, 39), geom = "area",
aes(fill = "Beta(8, 39)"), alpha = 0.5)
0.23+0.16
/2
0.39/2
ggplot() +
stat_function(fun = ~dbeta(., 1, 4), geom = "area",
aes(fill = "Beta(8, 39)"), alpha = 0.5)
1-.195
0.805/.195
ggplot() +
stat_function(fun = ~dbeta(., 1, 4.13), geom = "area",
aes(fill = "Beta(8, 39)"), alpha = 0.5)
sd(c(729,536))
CHAINS <- 4
ITER <- 2000
WARMUP <- 1000
BAYES_SEED <- 1234
often_comics_model_beta_binomial <- brm(
bf(n_contracts | trials(total_contracts) ~ 0 + category),
data = premium_annual,
family = beta_binomial(link = "identity", link_phi = "identity"),
prior = c(prior(beta(1, 4.13), class = "b", dpar = "mu", lb = 0, ub = 1),
prior(exponential(0.001), class = "phi", lb = 0)),
chains = CHAINS, warmup = WARMUP, iter = ITER, seed = BAYES_SEED,
refresh = 0
)
often_comics_model_beta_binomial <- brm(
bf(n_contracts | trials(total_contracts) ~ 0 + category),
data = premium_annual,
family = binomial(link = "identity"),
prior = c(prior(beta(1, 4.13), class = "b", dpar = "mu", lb = 0, ub = 1)),
chains = CHAINS, warmup = WARMUP, iter = ITER, seed = BAYES_SEED,
refresh = 0
)
library(rstantools)
library(tools)
often_comics_model_beta_binomial <- brm(
bf(n_contracts | trials(total_contracts) ~ 0 + category),
data = premium_annual,
family = binomial(link = "identity"),
prior = c(prior(beta(1, 4.13), class = "b", dpar = "mu", lb = 0, ub = 1)),
chains = CHAINS, warmup = WARMUP, iter = ITER, seed = BAYES_SEED,
refresh = 0
)
library(brms)
library(brm)
install.packages("brm")
library(brm)
often_comics_model_beta_binomial <- brm(
bf(n_contracts | trials(total_contracts) ~ 0 + category),
data = premium_annual,
family = binomial(link = "identity"),
prior = c(prior(beta(1, 4.13), class = "b", dpar = "mu", lb = 0, ub = 1)),
chains = CHAINS, warmup = WARMUP, iter = ITER, seed = BAYES_SEED,
refresh = 0
)
often_comics_model_beta_binomial <- brm(
bf(n_contracts | trials(total_contracts) ~ 0 + category),
data = premium_annual,
family = binomial(link = "identity"),
prior = c(prior(beta(1, 4.13), class = "b", dpar = "mu", lb = 0, ub = 1)),
chains = CHAINS, warmup = WARMUP, iter = ITER, seed = BAYES_SEED,
refresh = 0
)
library(cmdstanr)
cmdstanr::install_cmdstan()
install.packages("cmdstanr", repos = c("https://stan-dev.r-universe.dev", getOption("repos")))
cmdstanr::install_cmdstan()
cmdstanr::check_cmdstan_toolchain(fix = TRUE)
library(brms)
library(cmdstanr)
often_comics_model_beta_binomial <- brm(
bf(n_contracts | trials(total_contracts) ~ 0 + category),
data = premium_annual,
family = binomial(link = "identity"),
prior = c(prior(beta(1, 4.13), class = "b", dpar = "mu", lb = 0, ub = 1)),
chains = CHAINS, warmup = WARMUP, iter = ITER, seed = BAYES_SEED,
refresh = 0
)
detach("package:brm", unload = TRUE)
often_comics_model_beta_binomial <- brm(
bf(n_contracts | trials(total_contracts) ~ 0 + category),
data = premium_annual,
family = binomial(link = "identity"),
prior = c(prior(beta(1, 4.13), class = "b", dpar = "mu", lb = 0, ub = 1)),
chains = CHAINS, warmup = WARMUP, iter = ITER, seed = BAYES_SEED,
refresh = 0
)
often_comics_model_beta_binomial
install.packages("tidybayes")
premium_annual_beta_binomial <- brm(
bf(n_contracts | trials(total_contracts) ~ 0 + category),
data = premium_annual,
family = binomial(link = "identity"),
prior = c(prior(beta(1, 4.13), class = "b", dpar = "mu", lb = 0, ub = 1)),
chains = CHAINS, warmup = WARMUP, iter = ITER, seed = BAYES_SEED,
refresh = 0
)
premium_annual_beta_binomial %>%
epred_draws(newdata = premium_annual)
library(tidybayes)
premium_annual_beta_binomial %>%
epred_draws(newdata = premium_annual)
premium_annual_beta_binomial %>%
epred_draws(newdata = premium_annual)
premium_annual_beta_binomial%>%
epred_draws(newdata = premium_annual)
premium_annual_beta_binomial%>%
tidybayes::epred_draws(newdata = premium_annual)
tidybayes
library(tidybayes)
update.packages("tidyverse")
update.packaes("ggplot2")
update.packages("ggplot2")
premium_annual_beta_binomial%>%
tidybayes::epred_draws(newdata = premium_annual)
detach("package:ggplot2", unload = TRUE)
detach("package:brms", unload = TRUE)
library(ggplot2)
detach("package:ggplot2", unload = TRUE)
library(ggplot2)
detach("package:ggplot2", unload = TRUE)
posterior_epred(premium_annual_beta_binomial,premium_annual)
posterior_epred(premium_annual_beta_binomial,premium_annual)%>%
head()
premium_annual_beta_binomial%>%
tidybayes::epred_draws(newdata = premium_annual)
posterior_epred(premium_annual_beta_binomial,premium_annual)%>%
head()
posterior_epred(premium_annual_beta_binomial,premium_annual)%>%
head(100)
expected_values<-as.data.frame(posterior_epred(premium_annual_beta_binomial,premium_annual))
expected_values
expected_values%>%
mutate(difference=V1-V2)
expected_values%>%
mutate(difference=V1-V2)%>%
ggplot(aes(difference))+geom_histogram()
library(ggplot2)
expected_values%>%
mutate(difference=V1-V2)%>%
ggplot(aes(difference))+geom_histogram()
expected_values%>%
mutate(difference=V1-V2)%>%
ggplot(aes(difference))
expected_values%>%
mutate(difference=V1-V2)
prop.test(x=c(729,536),n=c(3127,3341))
prop.test(x=c(729,536),n=c(3127,3341),alt="greater")
