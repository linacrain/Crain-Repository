mutate(time_period=ifelse(Date<=as.Date("2023-05-31",format="%Y-%m-%d"),"2023 Jan 1st to May 31st","2024 Jan 1st to May 31st"))%>%
group_by(time_period)%>%
mutate(month=month(Date),
year=year(Date))%>%
mutate(end_date=if_else(month==1,as.Date("2023-01-31","%Y-%m-%d"),
if_else(month==2,as.Date("2023-02-28","%Y-%m-%d"),
if_else(month==3,as.Date("2023-03-31","%Y-%m-%d"),
if_else(month==4,as.Date("2023-04-30","%Y-%m-%d"),as.Date("2023-05-31","%Y-%m-%d"))))))%>%
group_by(ref_id,month,year,end_date)%>%
summarise(n_visits=n_distinct(Date),
n_articles=sum(n_articles_visited))%>%
ungroup()%>%
mutate(visit_segment=ifelse(n_visits==0,"inactive",
ifelse(n_visits<2,"Casual Reader",
ifelse(n_visits>=2&n_visits<=14,"Loyal Reader","Brand Lover"))))%>%
mutate(articles_per_day=round(n_articles/n_visits,2))%>%
ungroup()%>%
group_by(month,year,visit_segment)%>%
summarise(n=mean(articles_per_day))
segment_article_per_day<-rbind(segment_article_per_day_2023,segment_article_per_day_2024)
segment_article_per_day_graph<-segment_article_per_day%>%
mutate(Year=as.factor(year))%>%
ggplot(aes(month,n,color=Year,linetype=visit_segment,shape=visit_segment))+geom_point()+theme_minimal()+geom_line()+xlab("Month")+ylab("Avg. Articles Per Day Per User")+geom_text(aes(label=round(n,1)),size=2.5,position=position_dodge2(width=0.3),vjust=-0.3)
ggarrange(ggarrange(segmentation_2023,segmentation_2024,ncol=2,nrow=1,widths=c(3,3),common.legend=TRUE),segment_article_per_day_graph,nrow=2,ncol=1)
ggarrange(ggarrange(segmentation_2023,segmentation_2024,ncol=2,nrow=1,widths=c(3,3),common.legend=TRUE),segment_article_per_day_graph,nrow=2,ncol=1)
total_articles_by_month_segment_2023<-further_cleaned_an%>%
filter(Date<=as.Date("2023-05-31",format="%Y-%m-%d"))%>%
mutate(time_period=ifelse(Date<=as.Date("2023-05-31",format="%Y-%m-%d"),"2023 Jan 1st to May 31st","2024 Jan 1st to May 31st"))%>%
group_by(time_period)%>%
mutate(month=month(Date),
year=year(Date))%>%
group_by(ref_id,month,year)%>%
summarise(n_visits=n_distinct(Date),
n_articles=sum(n_articles_visited))%>%
filter(n_articles>0)
total_articles_by_month_segment_2024<-further_cleaned_an%>%
filter(Date>=as.Date("2024-01-01",format="%Y-%m-%d"))%>%
mutate(time_period=ifelse(Date<=as.Date("2023-05-31",format="%Y-%m-%d"),"2023 Jan 1st to May 31st","2024 Jan 1st to May 31st"))%>%
group_by(time_period)%>%
mutate(month=month(Date),
year=year(Date))%>%
group_by(ref_id,month,year)%>%
summarise(n_visits=n_distinct(Date),
n_articles=sum(n_articles_visited))%>%
filter(n_articles>0)
article_segment_2023<-total_articles_by_month_segment_2023%>%
rbind(total_articles_by_month_segment_2024)%>%
mutate(article_segment=ifelse(n_articles<=2,"1 - 2 Articles",
ifelse(n_articles>2&n_articles<=5,"3-5 Articles",
ifelse(n_articles>5&n_articles<=12,"5-12 Articles","13+ Articles"))))%>%
filter(year==2023)%>%
group_by(month,article_segment)%>%
summarise(n_users=n_distinct(ref_id))%>%
mutate(total_users=sum(n_users))%>%
mutate(share=n_users/total_users*100)%>%
mutate(Month=month.abb[(month)])%>%
mutate(`Proportion of Active Subscribers`=share)%>%
mutate(Month=factor(Month,levels=c("Jan","Feb","Mar","Apr","May")))%>%
mutate(article_segment=factor(article_segment,levels=c("1 - 2 Articles","3-5 Articles","5-12 Articles","13+ Articles")))%>%
ggplot(aes(Month,`Proportion of Active Subscribers`,fill=article_segment))+geom_bar(stat="identity")+geom_text(aes(label=paste(round(share,1),"%",sep="")),size=3,position=position_stack(vjust=0.6))+theme_minimal()+scale_fill_manual(values=c("13+ Articles"="lightblue","5-12 Articles"="lightgreen","3-5 Articles"="pink","1 - 2 Articles"="grey"))+xlab("Month(2023)")+ylab("")+labs(fill="Article Segment")
article_segment_2024<-total_articles_by_month_segment_2023%>%
rbind(total_articles_by_month_segment_2024)%>%
mutate(article_segment=ifelse(n_articles<=2,"1 - 2 Articles",
ifelse(n_articles>2&n_articles<=5,"3-5 Articles",
ifelse(n_articles>5&n_articles<=12,"5-12 Articles","13+ Articles"))))%>%
filter(year==2024)%>%
group_by(month,article_segment)%>%
summarise(n_users=n_distinct(ref_id))%>%
mutate(total_users=sum(n_users))%>%
mutate(share=n_users/total_users*100)%>%
mutate(Month=month.abb[(month)])%>%
mutate(`Proportion of Active Subscribers`=share)%>%
mutate(Month=factor(Month,levels=c("Jan","Feb","Mar","Apr","May")))%>%
mutate(article_segment=factor(article_segment,levels=c("1 - 2 Articles","3-5 Articles","5-12 Articles","13+ Articles")))%>%
ggplot(aes(Month,`Proportion of Active Subscribers`,fill=article_segment))+geom_bar(stat="identity")+geom_text(aes(label=paste(round(share,1),"%",sep="")),size=3,position=position_stack(vjust=0.6))+theme_minimal()+scale_fill_manual(values=c("13+ Articles"="lightblue","5-12 Articles"="lightgreen","3-5 Articles"="pink","1 - 2 Articles"="grey"))+xlab("Month(2024)")+ylab("")+labs(fill="Article Segment")
avg_articles_per_user_per_month<-total_articles_by_month_segment_2023%>%
rbind(total_articles_by_month_segment_2024)%>%
group_by(month,year)%>%
summarise(mean_articles=round(mean(n_articles),1))%>%
mutate(Month=month.abb[(month)])%>%
mutate(year=factor(year))%>%
mutate(Month=factor(Month,levels=c("Jan","Feb","Mar","Apr","May")))%>%
ggplot(aes(Month,mean_articles,fill=year))+geom_bar(stat="identity",position="dodge")+geom_text(aes(label=mean_articles),size=3,position=position_dodge(width=0.9),vjust=-0.3)+theme_minimal()+ylab("Avg. Articles Per User Per Month")+labs(fill="Year")+xlab("")
avg_articles_per_user_per_month
ggarrange(ggarrange(article_segment_2023,article_segment_2024,ncol=2,nrow=1,widths=c(3,3),common.legend=TRUE),avg_articles_per_user_per_month,ncol=1,nrow=2)
ggarrange(ggarrange(article_segment_2023,article_segment_2024,ncol=2,nrow=1,widths=c(3,3),common.legend=TRUE),avg_articles_per_user_per_month,ncol=1,nrow=2)
ggarrange(ggarrange(article_segment_2023,article_segment_2024,ncol=2,nrow=1,widths=c(3,3),common.legend=TRUE),avg_articles_per_user_per_month,ncol=1,nrow=2)
an_2024_unjoined
non_duplicated_clickshare_mappings
Clickshare_Mapping_to_Pelcro_IDs%>%
filter(`UID_ID from Adobe Extract`==463055)
an_2024_pelcro_clickshare_mapping
Clickshare_Mapping_to_Pelcro_IDs%>%
filter(`UID_ID from Adobe Extract`==957223)
Clickshare_Mapping_to_Pelcro_IDs%>%
filter(`UID_ID from Adobe Extract`==499785)
Clickshare_Mapping_to_Pelcro_IDs%>%
filter(`UID_ID from Adobe Extract`==147681)
clickshare_index_2
clickshare_index_2%>%
filter(clickshareuserid=='147681')
an_2024_pelcro_clickshare_mapping
an_2024_pelcro_clickshare_mapping%>%
is.na(customermasterkey)
an_2024_pelcro_clickshare_mapping%>%
filter(is.na(customermasterkey))
an_2024_pelcro_clickshare_mapping%>%
filter(is.na(customermasterkey))%>%
filter(!is.na(infinite(uid_max)))
an_2024_pelcro_clickshare_mapping%>%
filter(is.na(customermasterkey))%>%
filter(!is.na(is.infinite(uid_max)))
an_2024_pelcro_clickshare_mapping%>%
filter(is.na(customermasterkey))%>%
filter(!is.infinite(uid_max))%>%
select(uid_max)%>%
distinct()
an_2024_pelcro_clickshare_mapping%>%
filter(is.na(customermasterkey))%>%
filter(!is.infinite(uid_max))%>%
ungroup()%>%
select(uid_max)%>%
distinct()
list_of_missing<0an_2024_pelcro_clickshare_mapping%>%
list_of_missing<-an_2024_pelcro_clickshare_mapping%>%
filter(is.na(customermasterkey))%>%
filter(!is.infinite(uid_max))%>%
ungroup()%>%
select(uid_max)%>%
distinct()
list_of_missing
list_of_missing%>%
left_join(clickshare_index_2,by=c("uid_max"="clickshareuserid"))
list_of_missing%>%
mutate(uid_max=as.character(uid_max))%>%
left_join(clickshare_index_2,by=c("uid_max"="clickshareuserid"))
list_of_missing%>%
mutate(uid_max=as.character(uid_max))%>%
left_join(clickshare_index_2,by=c("uid_max"="clickshareuserid"))%>%
filter(isgroup!=TRUE)
sub_and_group_list
list_of_missing%>%
mutate(uid_max=as.character(uid_max))%>%
left_join(clickshare_index_2,by=c("uid_max"="clickshareuserid"))%>%
filter(isgroup!=TRUE)
sub_and_group_list%>%
filter(uid_max=="AN0000330241")
sub_and_group_list%>%
filter(customermasterkey=="AN0000330241")
clickshare_index_2%>%
group_by(customermasterkey)%>%
mutate(subscriber_check=ifelse(is.na(advantagecustomerid)&pelcrocustomerid==0,FALSE,TRUE))%>%
summarise(max_sub_check=max(subscriber_check),
max_group=max(isgroup))
clickshare_index_2%>%
group_by(customermasterkey)%>%
mutate(subscriber_check=ifelse(is.na(advantagecustomerid)&pelcrocustomerid==0,FALSE,TRUE))%>%
summarise(max_sub_check=max(subscriber_check),
max_group=max(isgroup))%>%
filter(customermasterkey=="AN0000330241")
clickshare_index_2%>%
filter(customermasterkey=="AN0000330241")
clickshare_index_2
list_of_missing%>%
mutate(uid_max=as.character(uid_max))%>%
left_join(clickshare_index_2,by=c("uid_max"="clickshareuserid"))%>%
filter(isgroup!=TRUE)
sub_and_group_list%>%
filter(customermasterkey=="	AN0000330241")
sub_and_group_list%>%
filter(customermasterkey=="AN0000330241")
sub_and_group_list%>%
filter(str_detect(,customermasterkey"AN0000330241"))
sub_and_group_list%>%
filter(str_detect(customermasterkey,"AN0000330241"))
sub_and_group_list%>%
filter(str_detect(customermasterkey,"330241"))
clickshare_index_2%>%
filter(str_detect(customermasterkey,"AN0000330241"))
clickshare_index_2%>%
group_by(customermasterkey)%>%
mutate(subscriber_check=ifelse(is.na(advantagecustomerid)&pelcrocustomerid==0,FALSE,TRUE))%>%
summarise(max_sub_check=max(subscriber_check),
max_group=max(isgroup))%>%
filter(str_detect(customermasterkey,"AN0000330241"))
list_of_missing%>%
mutate(uid_max=as.character(uid_max))%>%
left_join(clickshare_index_2,by=c("uid_max"="clickshareuserid"))%>%
filter(isgroup!=TRUE)
clickshare_index_2%>%
filter(str_detect(customermasterkey,"AN0000330241"))
list_of_missin
list_of_missing
list_of_missing%>%
mutate(uid_max=as.character(uid_max))%>%
left_join(clickshare_index_2,by=c("uid_max"="clickshareuserid"))
list_of_missing%>%
mutate(uid_max=as.character(uid_max))%>%
left_join(clickshare_index_2,by=c("uid_max"="clickshareuserid"))%>%
filter(is.na(customermasterkey))
list_of_missing%>%
mutate(uid_max=as.character(uid_max))%>%
left_join(clickshare_index_2,by=c("uid_max"="clickshareuserid"))
list_of_missing%>%
mutate(uid_max=as.character(uid_max))%>%
left_join(clickshare_index_2,by=c("uid_max"="clickshareuserid"))%>%
group_by(customermasterkey,uid_max)%>%
mutate(subscriber_check=ifelse(is.na(advantagecustomerid)&pelcrocustomerid==0,FALSE,TRUE))%>%
summarise(max_sub_check=max(subscriber_check),
max_group=max(isgroup))
list_of_missing%>%
list_of_missing%>%
mutate(uid_max=as.character(uid_max))%>%
left_join(clickshare_index_2,by=c("uid_max"="clickshareuserid"))%>%
filter(is.na(customermasterkey))
list_of_missing%>%
mutate(uid_max=as.character(uid_max))%>%
left_join(clickshare_index_2,by=c("uid_max"="clickshareuserid"))%>%
filter(is.na(customermasterkey))
Clickshare_Mapping_to_Pelcro_IDs
list_of_missing%>%
mutate(uid_max=as.character(uid_max))%>%
left_join(clickshare_index_2,by=c("uid_max"="clickshareuserid"))%>%
filter(is.na(customermasterkey))%>%
mutate(uid_max=as.double(uid_max))%>%
left_join(Clickshare_Mapping_to_Pelcro_IDs,by=c("uid_max"="UID_ID from Adobe Extract"))
Clickshare_Mapping_to_Pelcro_IDs
list_of_missing%>%
mutate(uid_max=as.character(uid_max))%>%
left_join(clickshare_index_2,by=c("uid_max"="clickshareuserid"))%>%
filter(is.na(customermasterkey))%>%
mutate(uid_max=as.double(uid_max))%>%
left_join(Clickshare_Mapping_to_Pelcro_IDs,by=c("uid_max"="UID_ID from Adobe Extract"))
list_of_missing%>%
mutate(uid_max=as.character(uid_max))%>%
left_join(clickshare_index_2,by=c("uid_max"="clickshareuserid"))%>%
filter(is.na(customermasterkey))%>%
mutate(uid_max=as.double(uid_max))%>%
left_join(Clickshare_Mapping_to_Pelcro_IDs,by=c("uid_max"="UID_ID from Adobe Extract"))%>%
filter(!is.na(pelcrocustomerid))
active_days_2023<-further_cleaned_an%>%
filter(Date<=as.Date("2023-05-31",format="%Y-%m-%d"))%>%
mutate(time_period=ifelse(Date<=as.Date("2023-05-31",format="%Y-%m-%d"),"2023 Jan 1st to May 31st","2024 Jan 1st to May 31st"))%>%
group_by(ref_id,time_period)%>%
summarise(n=n_distinct(Date))
active_days_2024<-further_cleaned_an%>%
filter(Date>=as.Date("2024-01-01",format="%Y-%m-%d"))%>%
mutate(time_period=ifelse(Date<=as.Date("2023-05-31",format="%Y-%m-%d"),"2023 Jan 1st to May 31st","2024 Jan 1st to May 31st"))%>%
group_by(ref_id,time_period)%>%
summarise(n=n_distinct(Date,na.rm=TRUE))
active_days<-rbind(active_days_2023,active_days_2024)
active_days%>%
group_by(time_period)%>%
summarise(mean=mean(n))
active_days_histogram<-active_days%>%
ggplot(aes(n,fill=time_period))+geom_histogram(alpha=0.2,position="identity")+theme_minimal()+scale_fill_manual(values = c("2023 Jan 1st to May 31st" = "red", "2024 Jan 1st to May 31st" = "blue"))+geom_vline(xintercept = 16.61,color="red",linetype="dashed")+geom_vline(xintercept = 17.63,color="blue",linetype="dashed")+xlim(c(0,100))+ylab("")+xlab("Active Days")+geom_text(x=19.158,y=3000,label=paste("2024 Mean: 17.63 Days"),size=4,hjust=-0.2,color="blue")+
geom_text(x=19.158,y=2000,label=paste("2023 Mean: 16.6 Days"),size=4,hjust=-0.2,color="red")+guides(fill="none")
active_days_boxplot<-active_days%>%
ggplot(aes(time_period,n,fill=time_period))+geom_boxplot(outliers=FALSE)+theme_minimal()+coord_flip()+ylab("Active Days")+xlab("")
gc()
an_active_days_model_unequal_variance <- brm(bf(n~time_period+0),
family=negbinomial(),
prior=c(
prior(normal(10,9),class="b",lb=0,ub=150),
prior(gamma(1,0.5),class="shape")),
data = active_days,
cores = 4,
chains = CHAINS, warmup = WARMUP, iter = ITER, seed = BAYES_SEED
)
saveRDS(an_active_days_model_unequal_variance,"an_active_days_model_negative_binomial.rds")
post<-posterior_samples(aa_active_days_model_unequal_variance)
post<-posterior_samples(an_active_days_model_unequal_variance)
post%>%
head(4000)%>%
mutate(exp_2023=exp(b_time_period2023Jan1sttoMay31st),
exp_2024=exp(b_time_period2024Jan1sttoMay31st))%>%
mutate(diff=exp_2024-exp_2023)%>%
summary(diff)
difference_in_means<-post%>%
head(4000)%>%
mutate(exp_2023=exp(b_time_period2023Jan1sttoMay31st),
exp_2024=exp(b_time_period2024Jan1sttoMay31st))%>%
mutate(diff=exp_2024-exp_2023)%>%
ggplot(aes(x=diff))+geom_histogram(fill="lightblue")+theme_minimal()+geom_vline(xintercept=1.03,color="black",linetype="dashed")+ylab("")+xlab("Difference in Total Active Days between 2024 and 2023")+geom_text(x=1.2,y=300,label=("Expected. Diff in Active Days:\n1.03 Days"),hjust=-0.01)
difference_in_means<-post%>%
head(4000)%>%
mutate(exp_2023=exp(b_time_period2023Jan1sttoMay31st),
exp_2024=exp(b_time_period2024Jan1sttoMay31st))%>%
mutate(diff=exp_2024-exp_2023)
post%>%
head(4000)%>%
mutate(exp_2023=exp(b_time_period2023Jan1sttoMay31st),
exp_2024=exp(b_time_period2024Jan1sttoMay31st))%>%
mutate(diff=exp_2024-exp_2023)
post%>%
head(4000)%>%
mutate(exp_2023=exp(b_time_period2023Jan1sttoMay31st),
exp_2024=exp(b_time_period2024Jan1sttoMay31st))%>%
mutate(diff=exp_2024-exp_2023)%>%
summary(diff)
an_active_days_model_unequal_variance
post%>%
head(4000)%>%
mutate(exp_2023=exp(b_time_period2023Jan1sttoMay31st),
exp_2024=exp(b_time_period2024Jan1sttoMay31st))%>%
mutate(diff=exp_2024-exp_2023)%>%
summary(diff)
difference_in_means<-post%>%
head(4000)%>%
mutate(exp_2023=exp(b_time_period2023Jan1sttoMay31st),
exp_2024=exp(b_time_period2024Jan1sttoMay31st))%>%
mutate(diff=exp_2024-exp_2023)%>%
ggplot(aes(x=diff))+geom_histogram(fill="lightblue")+theme_minimal()+geom_vline(xintercept=-2.1,color="black",linetype="dashed")+ylab("")+xlab("Difference in Total Active Days between 2024 and 2023")+geom_text(x=1.2,y=300,label=("Expected. Diff in Active Days:\n-2.1 Days"),hjust=-0.01)
ggarrange(ggarrange(active_days_histogram,active_days_boxplot,nrow=1,ncol=2,common.legend=TRUE),difference_in_means,nrow=2)
post%>%
head(4000)%>%
mutate(exp_2023=exp(b_time_period2023Jan1sttoMay31st),
exp_2024=exp(b_time_period2024Jan1sttoMay31st))%>%
mutate(diff=exp_2024-exp_2023)%>%
ggplot(aes(x=diff))+geom_histogram(fill="lightblue")+theme_minimal()+geom_vline(xintercept=-2.1,color="black",linetype="dashed")+ylab("")+xlab("Difference in Total Active Days between 2024 and 2023")+geom_text(x=1.2,y=300,label=("Expected. Diff in Active Days:\n-2.1 Days"),hjust=-0.01)
difference_in_means<-post%>%
head(4000)%>%
mutate(exp_2023=exp(b_time_period2023Jan1sttoMay31st),
exp_2024=exp(b_time_period2024Jan1sttoMay31st))%>%
mutate(diff=exp_2024-exp_2023)%>%
ggplot(aes(x=diff))+geom_histogram(fill="lightblue")+theme_minimal()+geom_vline(xintercept=-2.1,color="black",linetype="dashed")+ylab("")+xlab("Difference in Total Active Days between 2024 and 2023")+geom_text(x=-1.7,y=300,label=("Expected. Diff in Active Days:\n-2.1 Days"),hjust=-0.01)
post%>%
head(4000)%>%
mutate(exp_2023=exp(b_time_period2023Jan1sttoMay31st),
exp_2024=exp(b_time_period2024Jan1sttoMay31st))%>%
mutate(diff=exp_2024-exp_2023)%>%
ggplot(aes(x=diff))+geom_histogram(fill="lightblue")+theme_minimal()+geom_vline(xintercept=-2.1,color="black",linetype="dashed")+ylab("")+xlab("Difference in Total Active Days between 2024 and 2023")+geom_text(x=-1.7,y=300,label=("Expected. Diff in Active Days:\n-2.1 Days"),hjust=-0.01)
post%>%
head(4000)%>%
mutate(exp_2023=exp(b_time_period2023Jan1sttoMay31st),
exp_2024=exp(b_time_period2024Jan1sttoMay31st))%>%
mutate(diff=exp_2024-exp_2023)%>%
ggplot(aes(x=diff))+geom_histogram(fill="lightblue")+theme_minimal()+geom_vline(xintercept=-2.1,color="black",linetype="dashed")+ylab("")+xlab("Difference in Total Active Days between 2024 and 2023")+geom_text(x=-1.9,y=300,label=("Expected. Diff in Active Days:\n-2.1 Days"),hjust=-0.01)
difference_in_means<-post%>%
head(4000)%>%
mutate(exp_2023=exp(b_time_period2023Jan1sttoMay31st),
exp_2024=exp(b_time_period2024Jan1sttoMay31st))%>%
mutate(diff=exp_2024-exp_2023)%>%
ggplot(aes(x=diff))+geom_histogram(fill="lightblue")+theme_minimal()+geom_vline(xintercept=-2.1,color="black",linetype="dashed")+ylab("")+xlab("Difference in Total Active Days between 2024 and 2023")+geom_text(x=-1.8,y=300,label=("Expected. Diff in Active Days:\n-2.1 Days"),hjust=-0.01)
post%>%
head(4000)%>%
mutate(exp_2023=exp(b_time_period2023Jan1sttoMay31st),
exp_2024=exp(b_time_period2024Jan1sttoMay31st))%>%
mutate(diff=exp_2024-exp_2023)%>%
ggplot(aes(x=diff))+geom_histogram(fill="lightblue")+theme_minimal()+geom_vline(xintercept=-2.1,color="black",linetype="dashed")+ylab("")+xlab("Difference in Total Active Days between 2024 and 2023")+geom_text(x=-1.8,y=300,label=("Expected. Diff in Active Days:\n-2.1 Days"),hjust=-0.01)
post%>%
head(4000)%>%
mutate(exp_2023=exp(b_time_period2023Jan1sttoMay31st),
exp_2024=exp(b_time_period2024Jan1sttoMay31st))%>%
mutate(diff=exp_2024-exp_2023)%>%
ggplot(aes(x=diff))+geom_histogram(fill="lightblue")+theme_minimal()+geom_vline(xintercept=-2.1,color="black",linetype="dashed")+ylab("")+xlab("Difference in Total Active Days between 2024 and 2023")+geom_text(x=-1.84,y=300,label=("Expected. Diff in Active Days:\n-2.1 Days"),hjust=-0.01)
active_days%>%
group_by(time_period)%>%
summarise(mean=mean(n))
active_days%>%
group_by(time_period)%>%
summarise(mean=mean(n))
active_days%>%
ggplot(aes(n,fill=time_period))+geom_histogram(alpha=0.2,position="identity")+theme_minimal()+scale_fill_manual(values = c("2023 Jan 1st to May 31st" = "red", "2024 Jan 1st to May 31st" = "blue"))+geom_vline(xintercept = 23.36,color="red",linetype="dashed")+geom_vline(xintercept = 21.24,color="blue",linetype="dashed")+xlim(c(0,100))+ylab("")+xlab("Active Days")+geom_text(x=19.158,y=3000,label=paste("2024 Mean: 17.63 Days"),size=4,hjust=-0.2,color="blue")+
geom_text(x=19.158,y=2000,label=paste("2023 Mean: 16.6 Days"),size=4,hjust=-0.2,color="red")+guides(fill="none")
active_days_histogram<-active_days%>%
ggplot(aes(n,fill=time_period))+geom_histogram(alpha=0.2,position="identity")+theme_minimal()+scale_fill_manual(values = c("2023 Jan 1st to May 31st" = "red", "2024 Jan 1st to May 31st" = "blue"))+geom_vline(xintercept = 23.36,color="red",linetype="dashed")+geom_vline(xintercept = 21.24,color="blue",linetype="dashed")+xlim(c(0,100))+ylab("")+xlab("Active Days")+geom_text(x=19.158,y=3000,label=paste("2024 Mean: 21.24 Days"),size=4,hjust=-0.2,color="blue")+
geom_text(x=19.158,y=2000,label=paste("2023 Mean: 23.36 Days"),size=4,hjust=-0.2,color="red")+guides(fill="none")
active_days%>%
ggplot(aes(n,fill=time_period))+geom_histogram(alpha=0.2,position="identity")+theme_minimal()+scale_fill_manual(values = c("2023 Jan 1st to May 31st" = "red", "2024 Jan 1st to May 31st" = "blue"))+geom_vline(xintercept = 23.36,color="red",linetype="dashed")+geom_vline(xintercept = 21.24,color="blue",linetype="dashed")+xlim(c(0,100))+ylab("")+xlab("Active Days")+geom_text(x=19.158,y=3000,label=paste("2024 Mean: 21.24 Days"),size=4,hjust=-0.2,color="blue")+
geom_text(x=19.158,y=2000,label=paste("2023 Mean: 23.36 Days"),size=4,hjust=-0.2,color="red")+guides(fill="none")
active_days_histogram<-active_days%>%
ggplot(aes(n,fill=time_period))+geom_histogram(alpha=0.2,position="identity")+theme_minimal()+scale_fill_manual(values = c("2023 Jan 1st to May 31st" = "red", "2024 Jan 1st to May 31st" = "blue"))+geom_vline(xintercept = 23.36,color="red",linetype="dashed")+geom_vline(xintercept = 21.24,color="blue",linetype="dashed")+xlim(c(0,100))+ylab("")+xlab("Active Days")+geom_text(x=19.158,y=3000,label=paste("2024 Mean: 21.24 Days"),size=4,hjust=-0.2,color="blue")+
geom_text(x=19.158,y=2000,label=paste("2023 Mean: 23.36 Days"),size=4,hjust=-0.2,color="red")+guides(fill="none")
ggarrange(ggarrange(active_days_histogram,active_days_boxplot,nrow=1,ncol=2,common.legend=TRUE),difference_in_means,nrow=2)
ggarrange(ggarrange(active_days_histogram,active_days_boxplot,nrow=1,ncol=2,common.legend=TRUE),difference_in_means,nrow=2)
library(tidyverse)
library(DBI)
library(RPostgres)
library(ggplot2)
library(cmdstanr)
library(rstan)
library(StanHeaders)
library(rstantools)
library(tidybayes)
library(brms)
library(scales)
library(zoo)
library(ggpubr)
CHAINS <- 4
ITER <- 2000
WARMUP <- 1000
BAYES_SEED <- 1234
an_2024_cleaned<-read.csv("an_2024_cleaned.csv")
an_2023_cleaned<-read.csv("an_2023_cleaned.csv")
further_cleaned_an<-rbind(an_2024_cleaned,an_2023_cleaned)%>%
mutate(Date=as.Date(Date,format="%B %d, %Y"))
further_cleaned_an%>%
filter(Date>=as.Date("2024-01-01",format="%Y-%m-%d"))%>%
mutate(time_period=ifelse(Date<=as.Date("2023-05-31",format="%Y-%m-%d"),"2023 Jan 1st to May 31st","2024 Jan 1st to May 31st"))%>%
mutate(month=month(Date),
year=year(Date))%>%
group_by(ref_id,time_period,month)%>%
summarise(n=n_distinct(Date,na.rm=TRUE))
further_cleaned_an%>%
filter(Date>=as.Date("2024-01-01",format="%Y-%m-%d"))%>%
mutate(time_period=ifelse(Date<=as.Date("2023-05-31",format="%Y-%m-%d"),"2023 Jan 1st to May 31st","2024 Jan 1st to May 31st"))%>%
mutate(month=month(Date),
year=year(Date))%>%
group_by(ref_id,time_period,month)%>%
summarise(n=n_distinct(Date,na.rm=TRUE))%>%
group_by(month)%>%
ggplot(aes(month,n,fill=month))+geom_boxplot()+theme_minimal()+coord_flip()
further_cleaned_an%>%
filter(Date>=as.Date("2024-01-01",format="%Y-%m-%d"))%>%
mutate(time_period=ifelse(Date<=as.Date("2023-05-31",format="%Y-%m-%d"),"2023 Jan 1st to May 31st","2024 Jan 1st to May 31st"))%>%
mutate(month=month(Date),
year=year(Date))%>%
group_by(ref_id,time_period,month)%>%
summarise(n=n_distinct(Date,na.rm=TRUE))%>%
group_by(month)%>%
mutate(month=as.factor(month))%>%
ggplot(aes(month,n,fill=month))+geom_boxplot()+theme_minimal()+coord_flip()
active_days%>%
group_by(time_period)%>%
summarise(mean=mean(n))
further_cleaned_an%>%
filter(Date>=as.Date("2024-01-01",format="%Y-%m-%d"))%>%
mutate(time_period=ifelse(Date<=as.Date("2023-05-31",format="%Y-%m-%d"),"2023 Jan 1st to May 31st","2024 Jan 1st to May 31st"))%>%
mutate(month=month(Date),
year=year(Date))%>%
group_by(ref_id,time_period,month)%>%
summarise(n=n_distinct(Date,na.rm=TRUE))%>%
group_by(month)%>%
mutate(month=as.factor(month))%>%
ggplot(aes(month,n,fill=month))+geom_boxplot(outliers=FALSE)+theme_minimal()+coord_flip()
further_cleaned_an%>%
filter(Date>=as.Date("2024-01-01",format="%Y-%m-%d"))%>%
mutate(time_period=ifelse(Date<=as.Date("2023-05-31",format="%Y-%m-%d"),"2023 Jan 1st to May 31st","2024 Jan 1st to May 31st"))%>%
mutate(month=month(Date),
year=year(Date))%>%
group_by(ref_id,time_period,month)%>%
summarise(n=n_distinct(Date,na.rm=TRUE))%>%
group_by(month)%>%
summary()
further_cleaned_an%>%
filter(Date>=as.Date("2024-01-01",format="%Y-%m-%d"))%>%
mutate(time_period=ifelse(Date<=as.Date("2023-05-31",format="%Y-%m-%d"),"2023 Jan 1st to May 31st","2024 Jan 1st to May 31st"))%>%
mutate(month=month(Date),
year=year(Date))%>%
group_by(ref_id,time_period,month)%>%
summarise(n=n_distinct(Date,na.rm=TRUE))%>%
group_by(month)%>%
summarise(mean_active_days=mean(n),
total_active_users=n_distinct(ref_id),
median_active_days=median(n),
sd_n=sd(n))
further_cleaned_an%>%
filter(Date>=as.Date("2024-01-01",format="%Y-%m-%d"))%>%
mutate(time_period=ifelse(Date<=as.Date("2023-05-31",format="%Y-%m-%d"),"2023 Jan 1st to May 31st","2024 Jan 1st to May 31st"))%>%
mutate(month=month(Date),
year=year(Date))%>%
filter(month!=5)%>%
summary()
further_cleaned_an%>%
filter(Date>=as.Date("2024-01-01",format="%Y-%m-%d"))%>%
mutate(time_period=ifelse(Date<=as.Date("2023-05-31",format="%Y-%m-%d"),"2023 Jan 1st to May 31st","2024 Jan 1st to May 31st"))%>%
mutate(month=month(Date),
year=year(Date))%>%
group_by(ref_id,time_period,month)%>%
summarise(n=n_distinct(Date,na.rm=TRUE))%>%
filter(month!=5)%>%
ungroup()%>%
summarise(mean_days=mean(n))
further_cleaned_an%>%
filter(Date>=as.Date("2024-01-01",format="%Y-%m-%d"))%>%
mutate(time_period=ifelse(Date<=as.Date("2023-05-31",format="%Y-%m-%d"),"2023 Jan 1st to May 31st","2024 Jan 1st to May 31st"))%>%
mutate(month=month(Date),
year=year(Date))%>%
group_by(ref_id,time_period,month)%>%
summarise(n=n_distinct(Date,na.rm=TRUE))%>%
ungroup()%>%
summarise(mean_days=mean(n))
further_cleaned_an%>%
filter(Date>=as.Date("2024-01-01",format="%Y-%m-%d"))%>%
mutate(time_period=ifelse(Date<=as.Date("2023-05-31",format="%Y-%m-%d"),"2023 Jan 1st to May 31st","2024 Jan 1st to May 31st"))%>%
mutate(month=month(Date),
year=year(Date))%>%
group_by(ref_id,time_period)%>%
summarise(n=n_distinct(Date,na.rm=TRUE))%>%
ungroup()%>%
summarise(mean_days=mean(n))
further_cleaned_an%>%
filter(Date>=as.Date("2024-01-01",format="%Y-%m-%d"))%>%
mutate(time_period=ifelse(Date<=as.Date("2023-05-31",format="%Y-%m-%d"),"2023 Jan 1st to May 31st","2024 Jan 1st to May 31st"))%>%
mutate(month=month(Date),
year=year(Date))%>%
group_by(ref_id,time_period,month)%>%
summarise(n=n_distinct(Date,na.rm=TRUE))%>%
ungroup()%>%
group_by(month)%>%
summrarise(sum=sum(n))
further_cleaned_an%>%
filter(Date>=as.Date("2024-01-01",format="%Y-%m-%d"))%>%
mutate(time_period=ifelse(Date<=as.Date("2023-05-31",format="%Y-%m-%d"),"2023 Jan 1st to May 31st","2024 Jan 1st to May 31st"))%>%
mutate(month=month(Date),
year=year(Date))%>%
group_by(ref_id,time_period,month)%>%
summarise(n=n_distinct(Date,na.rm=TRUE))%>%
ungroup()%>%
group_by(month)%>%
summarise(sum=sum(n))
